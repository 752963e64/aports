# Maintainer: leso-kn <info@lesosoftware.com>
pkgname=piper-tts
pkgver=0.0.2
pkgrel=3
pkgdesc="Fast, local neural text to speech system"
url="https://github.com/rhasspy/piper"
provides="larynx2=$pkgver-r$pkgrel"
replaces=larynx2
# x86, s390x: not supported by onnxruntime
arch="all !x86 !s390x"
license="MIT"
depends_dev="
	espeak-ng-dev
	onnxruntime-dev
	"
makedepends="
	$depends_dev
	cmake
	pcaudiolib-dev
	samurai
	"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/rhasspy/piper/archive/refs/tags/v$pkgver.tar.gz
	use-system-onnxruntime.patch
	"
builddir="$srcdir"/piper-$pkgver

# upstream does not feature tests
options="!check"

build() {
	CXXFLAGS="$CXXFLAGS -flto=auto" \
	cmake -S src/cpp -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=None
	cmake --build build
}

package() {
	install -Dm755 build/piper \
		-t "$pkgdir"/usr/bin/

	mkdir -p "$pkgdir"/usr/include/piper
	cp -a src/cpp/*.h src/cpp/*.hpp src/cpp/utf8/ "$pkgdir"/usr/include/piper/
}

sha512sums="
3370586c7c099a44203cae6632bf1d2b5d95662f0e2ef3f218385f907d1d0d6bdd8b962f8459e1a2b6b297b69c3884f0903bb7dba2650309867f22f9d669c83a  piper-tts-0.0.2.tar.gz
ee090f37508c5eaa394034d4bd25cf82d1ca7dd14b06f23415dde1413ff30415c78fda9c4ca163b8f22655ff771c4e53200670c7aaf6dff161cf550d0ffe9f31  use-system-onnxruntime.patch
"
