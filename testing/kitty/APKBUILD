# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=kitty
pkgver=0.20.1
pkgrel=0
pkgdesc="Modern, hackable, featureful, OpenGL based terminal emulator"
url="https://sw.kovidgoyal.net/kitty/"
arch="all !mips !mips64" # fails to build on mips
license="GPL-3.0-only"
#some test fails, disabled for now:
#ERROR: test_box_drawing
#ERROR: test_emoji_presentation
#ERROR: test_font_rendering
#ERROR: test_shaping
#ERROR: test_sprite_map
options="!check"
depends="py3-pygments imagemagick ncurses ncurses-terminfo-base"
makedepends="py3-setuptools harfbuzz-dev zlib-dev libpng-dev freetype-dev
	fontconfig-dev mesa-dev python3-dev dbus-dev libxi-dev
	libxkbcommon-dev libxrandr-dev libxinerama-dev libxcursor-dev
	wayland-protocols wayland-dev py3-sphinx libcanberra-dev
	lcms2-dev"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/kovidgoyal/kitty/archive/v$pkgver.tar.gz
	fix-ppc64le-build-ioctl-with-musl.patch
	fix-uint.patch
	"

build() {
	SPHINXBUILD=sphinx-build python3 setup.py linux-package
}

check() {
	python3 setup.py test
}

package() {
	python3 setup.py linux-package --prefix "$pkgdir/usr"
}

sha512sums="9627a26f4396b708521d14f7577def589393ff7a67feb64a883a6a84bed249388918fc2aaac241081a07066afb1e8940626e1976f0b5d18fb2fef5eb621b1a89  kitty-0.20.1.tar.gz
330f56f5fd60607c57f4f2cffdf33768b3af9e4c3e271a60a05cc3c653d70f7402af91ba0cdfe0257c8b4779884a6440eb52496078bce11799aaa1829ced9245  fix-ppc64le-build-ioctl-with-musl.patch
ca495f54fbad351df48ab1d886d484cd0bcdbaf8445aaac9b3c5d34e3e65063891302e4421464eaec475f3f2ff716bb4e25f1a5fbbfeedd2fabc480a2c20da61  fix-uint.patch"
