# Contributor: Marian Buschsieweke <marian.buschsieweke@ovgu.de>
# Maintainer: Marian Buschsieweke <marian.buschsieweke@ovgu.de>
pkgname=rtl-sdr
pkgver=0.6.0
pkgrel=0
pkgdesc="General purpose software defined radio (SDR) driver for Realtek RTL2832U"
url="https://osmocom.org/projects/rtl-sdr/wiki/Rtl-sdr"
arch="all"
license="GPL-2.0-only"
makedepends="cmake libusb-dev"
subpackages="$pkgname-dev"
source="
	$pkgname-$pkgver.tar.xz::http://deb.debian.org/debian/pool/main/r/rtl-sdr/rtl-sdr_$pkgver.orig.tar.xz
	rtl-sdr.conf
	"
options="!check" # no tests provided
builddir="$srcdir/$pkgname-${pkgver:0:3}"

build() {
	cmake -B build \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DINSTALL_UDEV_RULES=ON \
		-Wno-dev
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --build build --target install
	mv "$pkgdir"/etc/udev/rules.d/rtl-sdr.rules \
		"$pkgdir"/etc/udev/rules.d/53-rtl-sdr.rules
	install -Dm644 "$srcdir"/rtl-sdr.conf "$pkgdir"/etc/modprobe.d/rtl-sdr.conf
}

sha512sums="86c224c887d03ede9b8568b5affcfc8a42345f74d01991b4907b473473ee229854b36ff6e4d24fe5bf919558625fc091b53dd3f9101d1a673441f51876d5dce7  rtl-sdr-0.6.0.tar.xz
d7f3a4e25d30617467437acdad95d2451f481934264be2c21c24f136c24f209fc5a9fc081fa4d973fc4e11810f5d79829a23caab3f0fc1538a58c205f75c4399  rtl-sdr.conf"
