# Contributor: Michał Polański <michal@polanski.me>
# Maintainer: Michał Polański <michal@polanski.me>
pkgname=podman
pkgver=2.0.0
pkgrel=0
pkgdesc="Simple management tool for pods, containers, and images"
url="https://podman.io/"
options="!check" # TODO: enable tests
arch="all !mips !mips64" # limited by go
license="Apache-2.0"
depends="conmon cni-plugins runc iptables ip6tables slirp4netns shadow-uidmap skopeo"
makedepends="go gpgme-dev libseccomp-dev libassuan-dev go-md2man btrfs-progs-dev bash"
subpackages="$pkgname-doc $pkgname-bash-completion $pkgname-zsh-completion"
source="$pkgname-$pkgver.tar.gz::https://github.com/containers/libpod/archive/v$pkgver.tar.gz"
builddir="$srcdir/libpod-$pkgver"

# secfixes:
#   1.8.1-r0:
#     - CVE-2020-1726

build() {
	export BUILDTAGS="exclude_graphdriver_devicemapper seccomp"
	make podman docs
}

package() {
	make install.bin install.man-nobuild install.completions install.cni \
		PREFIX=/usr DESTDIR="$pkgdir"
}

sha512sums="29f7e365dbd4ab6d20ee3e85939804f74dcfe95f65a6d030d1c10a36512c29d3934907cbb014047d659fd96ed3a2946570ef7922cd77cc729370ac099b4b58a2  podman-2.0.0.tar.gz"
