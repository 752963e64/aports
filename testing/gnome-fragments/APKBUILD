# Contributor: Rasmus Thomsen <oss@cogitri.dev>
# Maintainer: Rasmus Thomsen <oss@cogitri.dev>
pkgname=gnome-fragments
pkgver=1.4
_transmission_ver=2.94
pkgrel=0
pkgdesc="A GTK3 BitTorrent Client"
url="https://gitlab.gnome.org/World/Fragments"
arch="all"
license="GPL-3.0-only"
makedepends="meson gtk+3.0-dev libhandy-dev transmission-static vala bsd-compat-headers
	curl-dev dbus-glib-dev intltool libevent-dev libnotify-dev openssl-dev tar"
checkdepends="appstream-glib desktop-file-utils"
subpackages="$pkgname-lang"
source="https://gitlab.gnome.org/World/Fragments/-/archive/$pkgver/Fragments-$pkgver.tar.gz
	https://github.com/transmission/transmission-releases/raw/master/transmission-$_transmission_ver.tar.xz
	fix-lib-path.patch"
builddir="$srcdir/Fragments-$pkgver"

prepare() {
	default_prepare

	mv "$srcdir"/transmission-$_transmission_ver/* submodules/transmission
}

build() {
	meson \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--buildtype=plain \
		. output
	ninja -C output
}

check() {
	ninja -C output test
}

package() {
	DESTDIR="$pkgdir" ninja -C output install
}

sha512sums="f2c8e2153e85b9a8fedfea28862c74ad377ca75079f874d1e683a1848cd66bc79fee739d4986d2364a44f4dea8acd33b63b3ab94663884358d5ee41f5a068643  Fragments-1.4.tar.gz
ee411743940f2897aa0bbc351ce79f11d860075d2e9e399d60301eae8cfc453e20426ef553fc62ee43019a07c052d512f5d7972cc4411fb57b1312c2c1558da7  transmission-2.94.tar.xz
d66c2dc3f235c116f165c0e588ae773621a4edfaed31248bd256f12a52ca89d82f8d1803068bae0f6ecbf71b7b68c84ad4db1d34e14ea2c2aaa9c06a506c38ac  fix-lib-path.patch"
