# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=waydroid-image
pkgver=17.1.20210913
pkgrel=0
_pkgver="17.1-20210907"
_pkgver_images_vendor="17.1-20210907"
pkgdesc="Android containers for use in Waydroid"
url="https://github.com/waydroid/waydroid"
# Only x86, armv7, x86_64 and aarch64 supported upstream
arch="noarch !armhf !riscv64 !ppc64le !s390x"
license="Apache-2.0"
source="
	https://sourceforge.net/projects/waydroid/files/images/system/lineage/waydroid_x86_64/lineage-$_pkgver-VANILLA-waydroid_x86_64-system.zip
	https://sourceforge.net/projects/waydroid/files/images/system/lineage/waydroid_arm64/lineage-$_pkgver-VANILLA-waydroid_arm64-system.zip
	https://sourceforge.net/projects/waydroid/files/images/system/lineage/waydroid_x86/lineage-$_pkgver-VANILLA-waydroid_x86-system.zip
	https://sourceforge.net/projects/waydroid/files/images/system/lineage/waydroid_arm/lineage-$_pkgver-VANILLA-waydroid_arm-system.zip

	https://sourceforge.net/projects/waydroid/files/images/vendor/waydroid_arm64/lineage-$_pkgver_images_vendor-MAINLINE-waydroid_arm64-vendor.zip
	https://sourceforge.net/projects/waydroid/files/images/vendor/waydroid_x86_64/lineage-$_pkgver_images_vendor-MAINLINE-waydroid_x86_64-vendor.zip
	https://sourceforge.net/projects/waydroid/files/images/vendor/waydroid_x86/lineage-$_pkgver_images_vendor-MAINLINE-waydroid_x86-vendor.zip
	https://sourceforge.net/projects/waydroid/files/images/vendor/waydroid_arm/lineage-$_pkgver_images_vendor-MAINLINE-waydroid_arm-vendor.zip
	"
options="!check" # No code to test

case "$CARCH" in
	aarch64) _imgarch="arm64" ;;
	armv7) _imgarch="arm" ;;
	*) _imgarch="$CARCH" ;;
esac

unpack() {
	# Overwriting as it's easier to install directly while unzipping and we
	# don't need other arches than the native unpacked
	:
}

package() {
	install -dm755 "$pkgdir"/usr/share/waydroid-extra/images

	unzip -n \
			-q "$srcdir"/lineage-$_pkgver-VANILLA-waydroid_$_imgarch-system.zip \
			-d "$pkgdir"/usr/share/waydroid-extra/images
	unzip -n \
			-q "$srcdir"/lineage-$_pkgver_images_vendor-MAINLINE-waydroid_$_imgarch-vendor.zip \
			-d "$pkgdir"/usr/share/waydroid-extra/images
}

sha512sums="
ebf81c62978e0fd45fb50786a3bcbdc6d401991dd727a9b2537e05fb15ab0c12fa51cc45794f0a871367e0afa3c607e07247b8f7b53b4b3d803162f88fc38311  lineage-17.1-20210907-VANILLA-waydroid_x86_64-system.zip
d3ea11c2c926ce77d4c23d853aaf685536ea04b06251cb524569d8be8d8d8c46ca5d2c460ebd615732fc494848b28dd6855d2356346a94c0b2b368e95f720123  lineage-17.1-20210907-VANILLA-waydroid_arm64-system.zip
c30a81cf8c12ba145ef2723feeece11f1767cb70e784870e94b1da557445681fb727ff33733c558253341427d0d227a8a9bc5bb9bb488b99dfd8d7b019e658df  lineage-17.1-20210907-VANILLA-waydroid_x86-system.zip
0ec1defb6e628dd39d51695dd28d473cbff03b74828cf96915159978ec452214060f3f95b9e643974650b9bf3c83eea4ae63cdf17ad464620b82c26236d7aebf  lineage-17.1-20210907-VANILLA-waydroid_arm-system.zip
b7e8f45c0f90ecf3ca9cdfecce3265a3a0f188f71eecb541d5430409ab83d12cc9d6a2459af22b691c155b85215c479d93f32df3a0be9e1d86d21dbb43e9df0a  lineage-17.1-20210907-MAINLINE-waydroid_arm64-vendor.zip
a60bd3a89f13b86aed3190da4970d9d0f61fd300a21666ca58c0d0ff7a686a9c95c88e1122efd357010b4252bf9701bee798fb43af04747be7b88f89cba04b8b  lineage-17.1-20210907-MAINLINE-waydroid_x86_64-vendor.zip
b130ad73f38046ade6bd10ed74b7cd251c200aa8a5b786966a05a0e751bbec0469dd9312afc2e66823f6d7aeb3988cb29464857afc602745ace55bdba9535f15  lineage-17.1-20210907-MAINLINE-waydroid_x86-vendor.zip
c29445631294cd8ef09667746fef399b14c7cf38eb6f042c74e3808cfcf42e31b77a5d677ded5a7d39f1c42a2e6147b156479185424df6dc791605a0d6d1d35c  lineage-17.1-20210907-MAINLINE-waydroid_arm-vendor.zip
"
