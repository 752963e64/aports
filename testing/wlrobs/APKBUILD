# Maintainer: Marian Buschsieweke <marian.buschsieweke@ovgu.de>
pkgname=wlrobs
pkgver=0_hg20200607
pkgrel=0
pkgdesc="obs-studio plugin that allows you to screen capture on wlroots"
url="https://hg.sr.ht/~scoopta/wlrobs"
arch="x86 x86_64" # obs-stduio not provided on other platforms
license="GPL-3.0-only"
makedepends="meson ninja obs-studio-dev wayland-dev"
source="https://dev.alpinelinux.org/archive/wlrobs/wlrobs-$pkgver.tar.gz "
_srcrev="ab98e27c383d0a6239fc4641010c5fcd9e0f645a"
builddir="$srcdir/$pkgname-$_srcrev"
options="!check" # No tests provided

_srcurl="https://hg.sr.ht/~scoopta/wlrobs/archive/$_srcrev.tar.gz"

snapshot() {
	mkdir -p "$srcdir"
	wget "$_srcurl" -O "$srcdir/$pkgname-$pkgver.tar.gz"
	scp "$srcdir/$pkgname-$pkgver.tar.gz" \
		dev.alpinelinux.org:/archive/$pkgname/
}

build() {
	# Disable dmabuf backend, this requires a patched version of obs-studio,
	# which is not packaged
	abuild-meson \
		-Duse_dmabuf=false \
		build
	ninja -C build
}

package() {
	mkdir -p "$pkgdir/usr/lib/obs-plugins"
	install -Dm0644 -t "$pkgdir/usr/lib/obs-plugins/" build/libwlrobs.so
}

sha512sums="691613b0cf33ab5550c817229050d79463904ce54582f08a1c5b8f80fe0d64a61c45a285fccc6c9580b42245212de007a62a29674cc2bc76138c9803efc8fd26  wlrobs-0_hg20200607.tar.gz"
