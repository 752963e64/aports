# Contributor: Olliver Schinagl <oliver@schinagl.nl>
# Maintainer: Olliver Schinagl <oliver@schinagl.nl>
pkgname=nxp-mfgtools
pkgver=1.4.43
pkgrel=0
pkgdesc="Freescale/NXP i.MX Chip image deploy tools"
url="https://github.com/NXPmicro/mfgtools"
arch="all"
license="LGPL-2.1-only"
options="!check" # No tests available
subpackages="$pkgname-uuu:_uuu lib$pkgname-static lib$pkgname-dev"
makedepends="cmake libusb-dev bzip2-dev libzip-dev openssl-dev"
source="https://github.com/NXPmicro/mfgtools/archive/uuu_$pkgver.tar.gz
	0001-fails-to-build-on-alpine-arm32v6-fix-adding-interpre.patch
	"
builddir="$srcdir/mfgtools-uuu_$pkgver/"

prepare() {
	default_prepare
	echo "$pkgver" > "$builddir/.tarball-version"
}

build() {
	cmake -B build \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr
	cmake --build build
}

package() {
	depends="$subpackages"

	DESTDIR="$pkgdir" cmake --install build

	install -Dm644 build/libuuu/libuuc_s.a "$pkgdir/usr/lib/libuuc_s.a"
	install -Dm644 libuuu/libuuu.h "$pkgdir/usr/lib/libuuu.h"
}

_uuu() {
	amove usr/bin/uuu
}

sha512sums="
c00fb6809e03026b396a5a250dac78c2337377c02d86e9075d39e2f655d0844a633b1008a2f930bcb23ac3821bedf11705bfb46a1f6984382cf4f395a063753e  uuu_1.4.43.tar.gz
52293c2ddbb20c3c1b19256f3c6c987b5a43b230ce6da5bae5b6f932d8af27b0cee5b1654cff4b896000bb7f52c78be66ade856f8e95a726e845c0b7d9a6bc6d  0001-fails-to-build-on-alpine-arm32v6-fix-adding-interpre.patch
"
