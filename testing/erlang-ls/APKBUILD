# Contributor: Celeste <cielesti@protonmail.com>
# Maintainer: Celeste <cielesti@protonmail.com>
pkgname=erlang-ls
pkgver=0.52.0
pkgrel=0
pkgdesc="Erlang Language Server"
url="https://erlang-ls.github.io/"
arch="noarch"
license="Apache-2.0"
depends="erlang"
makedepends="erlang-dev rebar3"
checkdepends="erlang-doc"
source="https://github.com/erlang-ls/erlang_ls/archive/refs/tags/$pkgver/erlang-ls-$pkgver.tar.gz
	fix-version.patch
	"
builddir="$srcdir/erlang_ls-$pkgver"

prepare() {
	default_prepare

	sed -i "s/@ERLANG_LS_VERSION@/$pkgver/" \
		apps/els_lsp/src/els_lsp.app.src

	rebar3 get-deps
}

build() {
	rebar3 escriptize
}

check() {
	rebar3 ct
	rebar3 proper --constraint_tries 100
}

package() {
	install -Dvm755 _build/default/bin/erlang_ls \
		-t "$pkgdir"/usr/bin/
}

sha512sums="
ea35c7a5809e912871b622f2fad7109db64199f85c9d1c406051a2d421ab66f0dd69b50a9c1e740ddc522b080ecad5112e5276a9533bdccfaeaf15ec364d5b83  erlang-ls-0.52.0.tar.gz
c43bd08cd8953f1d067fe9bcc15dfcd841c9a825806c5e6fbd7183840ef5f8da7d0fd2e2dcc7f3625f928c4aa66500184692ece16cce1ccda41c086aaac797f0  fix-version.patch
"
