# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer: Michał Polański <michal@polanski.me>
pkgname=esptool
pkgver=3.3.1
pkgrel=0
pkgdesc="ESP8266 and ESP32 serial bootloader utility"
url="https://docs.espressif.com/projects/esptool"
license="GPL-2.0-or-later"
arch="noarch"
depends="python3 py3-cryptography py3-ecdsa py3-pyserial py3-bitstring py3-reedsolo"
makedepends="py3-setuptools"
checkdepends="py3-elftools"
source="$pkgname-$pkgver.tar.gz::https://github.com/espressif/esptool/archive/v$pkgver.tar.gz
	remove-py-wheel-requirement.patch
	"

build() {
	python3 setup.py build
}

check() {
	python3 test/test_imagegen.py
	python3 test/test_espsecure.py
	python3 test/test_merge_bin.py
	python3 test/test_modules.py
}

package() {
	python3 setup.py install --root="$pkgdir" --skip-build
}

sha512sums="
8da34f7b555513d499141ce403f19c3e77b6944eecde440c757faf3bbf5e915e44ff0bcabf1b2cb7f5fe26caa717bb47104ad808c46feaf1dea254d548048095  esptool-3.3.1.tar.gz
3474afb4b455c93d705334ea81450b21f2ff29858d266a9a4c157857cc7cc35ef7e8fe36758b64679f93d02b3d6647c32b36926051f2b8afa7dfeb0de82b3c4a  remove-py-wheel-requirement.patch
"
