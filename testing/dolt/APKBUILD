# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=dolt
pkgver=0.40.25
pkgrel=0
pkgdesc="Dolt â€“ It's Git for Data"
url="https://www.dolthub.com"
arch="all !x86 !armhf !armv7" # fails on 32-bit
license="Apache-2.0"
options="!check chmod-clean"
makedepends="go"
source="$pkgname-$pkgver.tar.gz::https://github.com/dolthub/dolt/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname-$pkgver/go"

export GOCACHE="$srcdir/go-cache"
export GOTMPDIR="$srcdir"
export GOMODCACHE="$srcdir/go"

build() {
	mkdir -p build
	go build \
		-trimpath \
		-buildmode=pie \
		-mod=readonly \
		-modcacherw \
		-ldflags "-extldflags=\"$LDFLAGS\"" \
		-o build \
		./cmd/...
}

package() {
	install -Dm755 build/dolt "$pkgdir"/usr/bin/dolt
	install -Dm755 build/dolt "$pkgdir"/usr/bin/git-dolt
	install -Dm755 build/dolt "$pkgdir"/usr/bin/git-dolt-smudge
}

sha512sums="
09ca3dd2937114308554373f42323788633f1507abb75c942ed0f512ad67ee04f472f5805bd8db192159155199ffe82291b7111df431bf14f1b6be774e45868a  dolt-0.40.25.tar.gz
"
