# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=dolt
pkgver=0.40.19
pkgrel=0
pkgdesc="Dolt â€“ It's Git for Data"
url="https://www.dolthub.com"
arch="all !x86 !armhf !armv7" # fails on 32-bit
license="Apache-2.0"
options="!check chmod-clean"
makedepends="go"
source="$pkgname-$pkgver.tar.gz::https://github.com/dolthub/dolt/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname-$pkgver/go"

export GOCACHE="$srcdir/go-cache"
export GOTMPDIR="$srcdir"
export GOMODCACHE="$srcdir/go"

build() {
	mkdir -p build
	go build \
		-trimpath \
		-buildmode=pie \
		-mod=readonly \
		-modcacherw \
		-ldflags "-extldflags=\"$LDFLAGS\"" \
		-o build \
		./cmd/...
}

package() {
	install -Dm755 build/dolt "$pkgdir"/usr/bin/dolt
	install -Dm755 build/dolt "$pkgdir"/usr/bin/git-dolt
	install -Dm755 build/dolt "$pkgdir"/usr/bin/git-dolt-smudge
}

sha512sums="
d960527ec24b70d4e25e2d11758ac0e173ebb34f4e55a608f061aedb295df159dc7e27b2ed58737441d2fe88a5ebfe784db5f4f96e34a91e2449783f717606e6  dolt-0.40.19.tar.gz
"
