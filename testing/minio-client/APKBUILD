# Contributor: Hoang Nguyen <folliekazetani@protonmail.com>
# Maintainer: Chloe Kudryavtsev <toast@toast.cafe>
pkgname=minio-client
_pkgname=mc
pkgver=0.20220823.054520
# 0.20220315.203000 -> 2022-03-15T20-30-00Z
_pkgver="${pkgver:2:4}-${pkgver:6:2}-${pkgver:8:2}T${pkgver:11:2}-${pkgver:13:2}-${pkgver:15:2}Z"
pkgrel=0
pkgdesc="The MinIO Client"
url="https://minio.io/"
arch="all"
license="AGPL-3.0-or-later"
makedepends="go"
source="https://github.com/minio/mc/archive/RELEASE.$_pkgver/$pkgname-$_pkgver.tar.gz"
builddir="$srcdir/$_pkgname-RELEASE.$_pkgver"

export CGO_ENABLED=0
export GOCACHE="$srcdir/go-cache"
export GOTMPDIR="$srcdir"
export GOMODCACHE="$srcdir/go"
export GOFLAGS="$GOFLAGS -modcacherw"

build() {
	local _ldflags=$(go run buildscripts/gen-ldflags.go 2>/dev/null)
	go build -v -tags kqueue -ldflags "$_ldflags" -o bin/mc
}

check() {
	# mc/cmd is disabled, seems to be outdated and fails on all my systems
	go test -tags kqueue $(go list ./... | grep -v cmd)
}

package() {
	install -Dm755 "$builddir"/bin/mc "$pkgdir"/usr/bin/mcli
}

sha512sums="
5812433340a2478ebee0235317cf88f0357773db9bbbf7af224fa70631cf464a9f512905d63ce5a17c3e52cc59761331ec2451d5121f692f483a617ae7d5e371  minio-client-2022-08-23T05-45-20Z.tar.gz
"
