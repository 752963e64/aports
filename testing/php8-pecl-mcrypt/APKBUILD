# Contributor: TBK <alpine@jjtc.eu>
# Maintainer: Andy Postnikov <apostnikov@gmail.com>
pkgname=php8-pecl-mcrypt
_extname=mcrypt
pkgver=1.0.3
pkgrel=0
pkgdesc="Provides PHP 8 bindings for the unmaintained libmcrypt - PECL"
url="https://pecl.php.net/package/mcrypt"
arch="all"
license="PHP-3.01"
depends="php8-common"
makedepends="php8-dev libmcrypt-dev"
source="php-pecl-$_extname-$pkgver.tgz::https://pecl.php.net/get/$_extname-$pkgver.tgz
	php8.patch
	https://github.com/php/pecl-encryption-mcrypt/commit/78a19090593013021ffe6a331b95957d4eadcd23.patch
	"
builddir="$srcdir/$_extname-$pkgver"

build() {
	phpize8
	./configure --prefix=/usr --with-php-config=php-config8
	make
}

check() {
	make NO_INTERACTION=1 REPORT_EXIT_STATUS=1 test
}

package() {
	make INSTALL_ROOT="$pkgdir" install
	local _confdir="$pkgdir"/etc/php8/conf.d
	install -d $_confdir
	echo "extension=$_extname" > $_confdir/$_extname.ini
}

sha512sums="ef215b576b471d6e1ecac4bb097f518fa57fd551b678b7fdddd9d5058f6667b0ee757e887f00b61672b89cd86f1962cbfe0e355681fa47daba9873c3bf4db679  php-pecl-mcrypt-1.0.3.tgz
38ce422b9fcb1ff62bf118dc9048f0afc5f4b8b04b14f2699fec26e6835d5eaf80149c98fa6dd83b7d1ced78da3416d937ac4f600000b4fd2c06f37178e69b6c  php8.patch
74658f780018eaf0cccd04652762584535a15dff0966209aa04f91f01cad17ae00c3588625106cf8a3858ef22d538e9148248ea0b06b10abf2ce829bf294a017  78a19090593013021ffe6a331b95957d4eadcd23.patch"
