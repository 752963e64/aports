# Maintainer: psykose <alice@ayaya.dev>
pkgname=turnstile
pkgver=0.1.1
pkgrel=1
pkgdesc="Independent session/login tracker"
url="https://github.com/chimera-linux/turnstile"
arch="all"
license="BSD-2-Clause"
makedepends="
	linux-pam-dev
	meson
	scdoc
	"
subpackages="$pkgname-doc $pkgname-openrc"
source="$pkgname-$pkgver.tar.gz::https://github.com/chimera-linux/turnstile/archive/refs/tags/v$pkgver.tar.gz
	default-none.patch
	turnstiled.confd
	turnstiled.initd
	"
options="!check" # no tests

build() {
	abuild-meson \
		-Db_lto=true \
		-Ddinit=disabled \
		-Dmanage_rundir=true \
		. output
	meson compile -C output
}


package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output

	install -Dm755 "$srcdir"/turnstiled.initd "$pkgdir"/etc/init.d/turnstiled
	install -Dm644 "$srcdir"/turnstiled.confd "$pkgdir"/etc/conf.d/turnstiled

	# love to non-usrmerge setup very good
	mkdir -p "$pkgdir"/lib/
	mv "$pkgdir"/usr/lib/security "$pkgdir"/lib/security/
}

sha512sums="
6d0d1ac6a196e93d1219a4c6f4d63a8531eab514a1b53a1e42b1cd14417933272e6abe405d9f13328640eb9ce7b16e777d364ab627893a1c8c85b43f454809f8  turnstile-0.1.1.tar.gz
f375509474e80d353b5e059611e429ef42a721e411c3967fa981d6cee38bfa2a1e3ec347fb3b1d2347ec521de6e735ce7317ea70fa2d05380bcea9d607419149  default-none.patch
4798d04b707e3b44467c1e75481a5123dbf4755ef1bdd09ac31d180762f67085a7030c4ba7d1f27b1ef30910785d8739375a730f32647c7d554142fac4d6b824  turnstiled.confd
c341bb0e997561579039daf14fd9607527a99250206e157afcccfd468a35b1bdf85592976e38672e27173aab112d8d1a8e4ca2e6ac2dd1b4789dbb9da832b155  turnstiled.initd
"
