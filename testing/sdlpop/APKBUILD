# Contributor: Thomas Kienlen <kommander@laposte.net>
# Maintainer: Thomas Kienlen <kommander@laposte.net>
pkgname=sdlpop
_pkgname=SDLPoP
pkgver=1.22
pkgrel=0
pkgdesc="Open-source port of Prince of Persia"
url="https://github.com/NagyD/SDLPoP"
arch="all !s390x" # does not compile on s390x
license="GPL-3.0-or-later"
makedepends="sdl2_image-dev sdl2_mixer-dev"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/NagyD/SDLPoP/archive/refs/tags/v$pkgver.tar.gz
	prince.sh
	"
options="!check" # No test suite
builddir="$srcdir/$_pkgname-$pkgver"

build() {
	make -C src
}

package() {
	mkdir -p "$pkgdir"/usr/share/sdlpop
	cp -r data doc mods SDLPoP.ini "$pkgdir"/usr/share/sdlpop

	# Custom launch script required as data are currently searched in the
	# current folder only
	#
	# https://github.com/NagyD/SDLPoP/issues/181
	# https://github.com/NagyD/SDLPoP/issues/103#issuecomment-885990319
	install -Dm755 "$srcdir"/prince.sh "$pkgdir"/usr/bin/prince
	install -Dm755 prince "$pkgdir"/usr/bin/sdlpop-prince

	mkdir -p "$pkgdir"/usr/share/applications
	sed \
		-e 's|Exec=.*|Exec=/usr/bin/prince|' \
		-e 's|Icon=.*|Icon=/usr/share/sdlpop/data/icon.png|' \
		-e 's|Path=.*|Path=/usr/share/sdlpop|' \
		src/SDLPoP.desktop.template > \
		"$pkgdir"/usr/share/applications/sdlpop.desktop
}

sha512sums="
d25777066c7293742a61aa75bb7be2fc20bad6a2ca8f46918978396a53a25cca532f238d1f8d679021ecb353aadeec9a199791045ffc2b90ae7ee45a3e1041da  sdlpop-1.22.tar.gz
75cb75da47f08d9d1d2725afa9bc8862a55778b3644a9debc868f96cb030172f4592df0f7d52e44f759174ce74e29bfd9bc58d4cfc568dbd0e376cfd5f4ffe21  prince.sh
"
