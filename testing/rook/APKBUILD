# Contributor: Sean E. Russell <ser@ser1.net>
# Maintainer: Sean E. Russell <ser@ser1.net>
pkgname=rook
pkgver=0.1.1
pkgrel=0
pkgdesc="Lightweight, stand-alone, headless secret service tool backed by a Keepass v2 database"
url="https://sr.ht/~ser/rook"
arch="all"
license="BSD-3-Clause"
makedepends="go makeclapman"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://hg.sr.ht/~ser/rook/archive/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname-v$pkgver"

build() {
	go build -ldflags "-X main.Version=v$pkgver" -v .

	mkdir man1
	CLAPTRAP_USAGE_JSON=true ./rook | \
		makeclapman -d man1 --author "Sean E. Russell" \
			--description "Rook allows you to use a KeePass v2 database as storage for secrets. It provides client and server modes; the server unlocks the database and stays in memory, while the client communicates over a socket with the server and fetches data."
}

check() {
	[ "$(./rook --version)" = "rook v$pkgver" ]
}

package() {
	install -Dm755 rook -t "$pkgdir"/usr/bin/
	install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/"$pkgname"/
	install -Dm644 README.md -t "$pkgdir"/usr/share/doc/"$pkgname"/
	install -Dm644 man1/* -t "$pkgdir"/usr/share/man/man1/
}

sha512sums="
1d168ff47b9550dbf48fb5e4f3ac771cc79a72d9d485067d273ddfe2e0dc56a3f2fa2b3759b697bf4337d5822a2b5965691e09520f2d4a39f858a75e6a511463  rook-0.1.1.tar.gz
0d468febad1205eb99a340a372c246a24f75f24090195752aa7caeb4b7d0358e7bfa485db5f16b5f63d81cd65902b7c53ad3a3cd07b8a39a88ff66d6588b0316  claphelp.tar.gz
"
