# Maintainer: Thomas Liske <thomas@fiasko-nw.net>
pkgname=bird-lg-go
pkgver=1.1.0
pkgrel=0
pkgdesc="BIRD looking glass in Go"
url="https://github.com/xddxdd/bird-lg-go"
arch="all"
license="GPL-3.0"
makedepends="go"
options="net"
source="https://github.com/xddxdd/bird-lg-go/archive/v$pkgver/bird-lg-go-$pkgver.tar.gz
	bird-lg-go.initd
	bird-lgproxy-go.initd
"
install="
	$pkgname.pre-install
	bird-lgproxy-go.pre-install
"
subpackages="$pkgname-openrc bird-lgproxy-go:lgproxy bird-lgproxy-go-openrc"

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
	make all
}

check() {
	cd $builddir/frontend
	go test -v
}

package() {
	install -Dm755 proxy/proxy "$pkgdir"/usr/bin/bird-lgproxy-go
	install -Dm755 frontend/frontend "$pkgdir"/usr/bin/bird-lg-go

	install -Dm755 "$srcdir/bird-lg-go.initd" "$pkgdir"/etc/init.d/bird-lg-go
}

lgproxy () {
	amove usr/bin/bird-lgproxy-go

	install -Dm755 "$srcdir/bird-lgproxy-go.initd" "$pkgdir"/etc/init.d/bird-lgproxy-go
}

sha512sums="
5f66d427f5e9a6a8ce9f91506ae250562d469059e6e94f11ad992f45c8167a0d3653eec507c1a60a42e065b95348c8d12fc5236cc2ae7d54bab70a93b8956159  bird-lg-go-1.1.0.tar.gz
7f29b969801fa190d4b46c76cf6d741c4cbf8faaa0b5264964d6db42e54f830827e079e0d1a96d4b9221b76430676e9281b4c9ea1033fae18f09d944fe22fa47  bird-lg-go.initd
68943f03cec52da4c0b1c0bc800cb865aae224e0e4f11e0dab6479394df59cdd33292ce94e42883cac536ad872378cad9af189a255b9793cfff42d325fed52d1  bird-lgproxy-go.initd
"
