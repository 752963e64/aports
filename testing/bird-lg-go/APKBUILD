# Maintainer: Thomas Liske <thomas@fiasko-nw.net>
pkgname=bird-lg-go
pkgver=1.1.0
pkgrel=1
pkgdesc="BIRD looking glass in Go"
url="https://github.com/xddxdd/bird-lg-go"
arch="all"
license="GPL-3.0-only"
makedepends="go"
options="net"
source="https://github.com/xddxdd/bird-lg-go/archive/v$pkgver/bird-lg-go-$pkgver.tar.gz
	bird-lg-go.initd
	bird-lgproxy-go.initd
	bird-lg.yaml
	bird-lgproxy.yaml
"
install="
	$pkgname.pre-install
	bird-lgproxy-go.pre-install
"
subpackages="$pkgname-openrc bird-lgproxy-go:lgproxy bird-lgproxy-go-openrc"

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
	make all
}

check() {
	cd $builddir/frontend
	go test -v
}

package() {
	install -Dm755 proxy/proxy "$pkgdir"/usr/bin/bird-lgproxy-go
	install -Dm755 frontend/frontend "$pkgdir"/usr/bin/bird-lg-go

	install -Dm755 "$srcdir/bird-lg-go.initd" "$pkgdir"/etc/init.d/bird-lg-go
	install -Dm644 "$srcdir/bird-lg.yaml" "$pkgdir"/etc/bird-lg/bird-lg.yaml
}

lgproxy() {
	amove usr/bin/bird-lgproxy-go

	install -Dm755 "$srcdir/bird-lgproxy-go.initd" "$pkgdir"/etc/init.d/bird-lgproxy-go
	install -Dm644 "$srcdir/bird-lgproxy.yaml" "$pkgdir"/etc/bird-lg/bird-lgproxy.yaml
}

sha512sums="
5f66d427f5e9a6a8ce9f91506ae250562d469059e6e94f11ad992f45c8167a0d3653eec507c1a60a42e065b95348c8d12fc5236cc2ae7d54bab70a93b8956159  bird-lg-go-1.1.0.tar.gz
81700fcb8c78c4847b7f7840e7bb8f25421c919d1d0dd3447d46055a1b0a248ddc718329d2207bdadb4f062ccf733df66bc06b5912e43c1e11410edb3c1478b8  bird-lg-go.initd
e3a6887f532320721cc5df4404643c3c7ac19fba26a23034fb62c0814a420e866cdb6454866efc970a8019ac4f7e8ee89cdc23448178aef562d939543010aef0  bird-lgproxy-go.initd
e6d38b8cc0b8b53a49fef59508bea40a6b81c8734cb44ab6cb69af89c76554f4ef538039b1767b88cd5922881de7c565e7153da57585290951f577e9ebcf068c  bird-lg.yaml
f53118b333efb8bb4aa12fbdf68a1ac534bc779c921fa0ee0b701ff5ff7d28aba169e19df943cd29f517d4e840c5429dd98d2ef378286a1ba96359c76a48740a  bird-lgproxy.yaml
"
