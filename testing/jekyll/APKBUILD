# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=jekyll
_gemname=jekyll
pkgver=4.2.0
pkgrel=0
pkgdesc="A blog-aware static site generator in Ruby"
url="https://jekyllrb.com/"
arch="noarch"
license="MIT"
# Dependencies specified in jekyll.gemspec. Keep in sync!
_gemspec_depends="$depends
	ruby-addressable~=2
	ruby-colorator~=1
	ruby-em-websocket~=0
	ruby-i18n~=1
	ruby-jekyll-sass-converter~=2
	ruby-jekyll-watch~=2
	ruby-kramdown~=2
	ruby-kramdown-parser-gfm~=1
	ruby-liquid~=4
	ruby-mercenary~=0.4
	ruby-pathutil~=0
	ruby-rouge~=3
	ruby-safe_yaml~=1
	ruby-terminal-table~=2
	"
depends="ruby-$_gemname=$pkgver-r$pkgrel
	ruby
	ruby-bigdecimal
	ruby-json
	ruby-webrick
	ruby-bundler
	$_gemspec_depends
	"
subpackages="ruby-$_gemname:_ruby"
source="https://github.com/jekyll/jekyll/archive/v$pkgver/$pkgname-$pkgver.tar.gz
	gemspec.patch
	"
builddir="$srcdir/$_gemname-$pkgver"
options="!check"  # FIXME: tests require extra dependencies

build() {
	gem build $_gemname.gemspec
}

package() {
	local gemdir="$pkgdir/$(ruby -e 'puts Gem.default_dir')"

	gem install \
		--local \
		--install-dir "$gemdir" \
		--bindir "$pkgdir/usr/bin" \
		--ignore-dependencies \
		--no-document \
		--verbose \
		$_gemname

	# Remove unnecessary files and rubbish...
	cd "$gemdir"
	rm -r cache build_info doc extensions
}

_ruby() {
	amove usr/lib/ruby
}

sha512sums="
aee4d832631a285c3d37576b5f3d80073b56afefcb8c8a19a74435ce431b606b5cedc28a02c8e3930f9bc35ab432c952f96e1878b3bee6b9d33fbd01f0a147ec  jekyll-4.2.0.tar.gz
5c67bc5e90fbd1283687cff1cc01491de842d4235b277658aefbbdac88b3b7d104e1293de177b5c41eace4a04433ad4ba333efebde4ad85bb0f9b6663b414e4b  gemspec.patch
e238530e35bdb4fe31b0967d39beb6a4a95ec1ed7912b51dddf55b95dad43dd728353f4b25526874da2d8a786c4be4d48bca7f1a1c6f19292dfb9309338c4291  0001-test-helper-disable-simplecov-and-minitest-plugins.patch
4f9f5f68347f5d002353ba62fd6ca63d54146ded69bd3ddd4e02677ee4fe599ae29e6ddeaceb2bab2b72ae90b8da70a42a73bca0d1d5d450aa541728c658fe0b  0003-test-disable-tests-requiring-the-test-theme.patch
54abcf285ddbc63a7519fea584449756c1e17398d19a3b290818b4938d07bf0b18ecc4a80de4a7e9a51d681be1fd7b5d2b8d4cd31f3d56b8ff9825facc3632b1  0006-test-plugin_manager-disable-tests-requiring-gemspec-.patch
48187ca2faf72372141b61057b78cf05951264a254a9d931fade96b556b2685cd7889bd2ad96898dde9e23ea9401e790e6a4b8b32a161fd0a7166162936347fc  0007-test-kramdown-disable-race-y-test.patch
a955f6660189454655fea7f22bd53cae7270b241e5e675433404e35f33dcd08f5bdece04c0a2d3aa5ea39611dbe44146799471b089ca69b1233f9dadf54bc2f3  0008-test-separate-keyword-arguments.patch
"
