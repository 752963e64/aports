# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=apx
pkgver=1.5.0
pkgrel=1
pkgdesc="A package manager that can install packages from multiple sources without altering the root filesystem"
url="https://github.com/Vanilla-OS/apx"
license="GPL-3.0-only"
# s390x and riscv64 blocked by podman -> distrobox
arch="all !s390x !riscv64"
depends="distrobox"
makedepends="go"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver-2.tar.gz::https://github.com/Vanilla-OS/apx/archive/$pkgver/apx-$pkgver.tar.gz
	config.json
	"
# net required to download go modules
# no tests
options="net !check"

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
	go build -trimpath -v -o apx
}

package() {
	install -Dm755 apx "$pkgdir"/usr/bin/apx
	install -Dm644 "$srcdir"/config.json "$pkgdir"/etc/apx/config.json

	install -Dm755 man/apx.1 "$pkgdir"/usr/share/man/man1/apx.1
	install -Dm755 man/es/apx.1 "$pkgdir"/usr/share/man/es/man1/apx.1
}

sha512sums="
36a4e59866f0ffba4c37a2b2ee4fef8321c5978bc4e3264f6fda22bd56b165658bc81e25de8661b22c0d8ed37c7d4a5419d0f23076dd2d5f1ceff43d5daa0107  apx-1.5.0-2.tar.gz
53bbd1121381c030518c0ede214ad28da782b216c3ed57bf0a85051f495a33ec2da7ea57f2883579b36a6a20c8ec351b573164467426063061762b32ebef859f  config.json
"
