# Contributor: Nicolas Lorin <androw95220@gmail.com>
# Maintainer: Jonathan Sieber <mail@strfry.org>
pkgname=toxcore
pkgver=0.2.16
pkgrel=0
pkgdesc="Tox communication project - Core Library"
url="https://tox.chat/"
arch="all"
license="GPL-3.0-or-later"
makedepends="linux-headers cmake libsodium-dev opus-dev libvpx-dev msgpack-c-dev"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/TokTok/c-toxcore/archive/v$pkgver.tar.gz"

# Toxcore's tests do require networking and are not working properly in Travis-CI
options="!check"

builddir="$srcdir/c-$pkgname-$pkgver"

build() {
	cmake . \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_LIBDIR=lib

	make
}

check() {
	make test
}

package() {
	make DESTDIR="$pkgdir" install
	rm -f "$pkgdir"/usr/lib/*.a
}

sha512sums="
e0f76da8042d122d87f55bf5687f1356214d9fb870b61db75a738b2d7fef1a8078cede7fbf15b6527a28e0219ba09438c0a770b5b1099f797a6848eab52621c4  toxcore-0.2.16.tar.gz
"
