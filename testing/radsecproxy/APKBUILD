# Contributor: Josef Vybíhal <josef.vybihal@gmail.com>
# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Josef Vybíhal <josef.vybihal@gmail.com>
pkgname=radsecproxy
pkgver=1.9.1
pkgrel=1
pkgdesc="Generic RADIUS proxy that supports both UDP and TLS (RadSec) RADIUS transports"
url="https://github.com/radsecproxy/radsecproxy"
license="BSD-3-Clause"
arch="all"
makedepends="nettle-dev openssl-dev autoconf automake"
subpackages="$pkgname-doc $pkgname-openrc"
source="https://github.com/radsecproxy/radsecproxy/releases/download/$pkgver/radsecproxy-$pkgver.tar.gz
	radsecproxy.conf
	$pkgname.initd
	$pkgname.confd
	"

prepare() {
	default_prepare
	autoreconf -fi
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install

	# NOTE: radsecproxy.conf-example is a garbage, so we rather install our
	#  minimal config that actually works.
	install -Dm644 "$srcdir"/radsecproxy.conf "$pkgdir"/etc/radsecproxy.conf

	install -Dm755 "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -Dm644 "$srcdir"/$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname

	install -Dm644 radsecproxy.conf-example -t "$pkgdir"/usr/share/doc/$pkgname/
	install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

sha512sums="
e72a3b55089cb985503c74a0aa0c62e0a05ac5325217900d39aa87563dd639f154ee372ac5e62ecd5aed92b832b0e58bc43f9588ed7950ec731fa5b297e5c07c  radsecproxy-1.9.1.tar.gz
d1cf3b812854f952d69d536fbd9381e71debdd083992a8882d68427ffbadc29f6cc73b43d61dcafacad731d3f78cd4828dc7c0ade7172947ddb68b08f28f0dc1  radsecproxy.conf
68f569eb4fe0b4f5e9c6e1f65a596b1cd4d38521adad782b80e6a3228f74ed86e02b962c2ccefa20b9b3b16649c03af7b9105b4ae3ad568a8c05b1acd12d3bc7  radsecproxy.initd
e268759550151b31dcbc41d63b4a3f5c99c5aab5e85ecc0b52fe0027dd918af0fae1fd7298b0abdf9e31c8764f80e98de65483d13bb57739468ae12c9cb480b8  radsecproxy.confd
"
