# Contributor: Carlo Landmeter <clandmeter@alpinelinux.org>
# Maintainer: Patrycja Rosa <alpine@ptrcnull.me>
pkgname=drone
pkgver=2.9.0
pkgrel=0
pkgdesc="Container-Native, Continuous Delivery Platform"
url="https://drone.io/"
license="custom"
arch="all"
makedepends="go"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/drone/drone/archive/v$pkgver.tar.gz"

export GOPATH="$srcdir"

build() {
	GO111MODULE=on go build -o bin/drone-server ./cmd/drone-server
}

check() {
	go test ./...
}

package() {
	install -Dm775 "$builddir"/bin/drone-server \
		"$pkgdir"/usr/bin/drone-server
	install -Dm 644 "$builddir"/LICENSE \
		"$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}

cleanup_srcdir() {
	go clean -modcache
	default_cleanup_srcdir
}

sha512sums="
294f18df4f40bdad8a6812379ab7bb30c5c7347218e85ddd9fe8dfbd6c42daff049c3d7e4c18bd7ed313602ae996fc0b6e46fe6a0e2ad9f522f2a68bb35f7b66  drone-2.9.0.tar.gz
"
