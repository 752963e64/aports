# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer: Sören Tempel <soeren+alpine@soeren-tempel.net>
pkgname=guile-git
pkgver=0.5.2
pkgrel=0
pkgdesc="Guile bindings of libgit2"
url="https://gitlab.com/guile-git/guile-git"
arch="all"
license="GPL-3.0-or-later"
depends="guile guile-bytestructures libgit2-dev"
makedepends="autoconf automake guile-dev zlib-dev texinfo"
subpackages="$pkgname-doc"
options="!strip" # https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=907061
source="https://gitlab.com/guile-git/guile-git/-/archive/v$pkgver/guile-git-v$pkgver.tar.bz2
	no-network-tests.patch"
builddir="$srcdir/$pkgname-v$pkgver"

# TODO: check() fails on arm, needs investigation.
case $CARCH in
arm*) options="$options !check" ;;
esac

prepare() {
	default_prepare
	autoreconf -vfi

	# remove proxy.scm tests as it requires network access
	rm -f tests/proxy.scm
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
905e03323a65bd057a50fc75265446407b9b6263852d3fa947a261d66b00ded2965bdb883ec8585c4748a28a1e0ce762a41511004a69fd1b1649c4146703278c  guile-git-v0.5.2.tar.bz2
fc3034e76b7fa384a61ed91713fdc010acd0aa99e9b511344636b86696f692e52b474c79e9fcca6397456311123ae3db0696e55e4a7358ed056478a74b481700  no-network-tests.patch
"
