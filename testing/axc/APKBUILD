# Contributor: Clayton Craft <clayton@craftyguy.net>
# Maintainer: Clayton Craft <clayton@craftyguy.net>
pkgname=axc
pkgver=0.3.3
pkgrel=0
pkgdesc="Client lib for libsignal-c"
arch="all"
url="https://github.com/gkdr/axc"
license="GPL-3.0-or-later"
makedepends="
	glib-dev
	libgcrypt-dev
	libsignal-protocol-c-dev
	sqlite-dev
	"
checkdepends="cmocka-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/gkdr/axc/archive/v$pkgver.tar.gz
	0001-Add-make-install-target-shared-library-and-soname-su.patch
	0002-added-pkgconfig-suport.patch
	0003-no-longer-statically-build-against-libsignal-protoco.patch
	0004-Autogenerate-PKGCONFIG-file-through-Makefile.patch
	0005-pkgconfig-file-generation-with-correct-Requires-fiel.patch
	"
subpackages="$pkgname-dev"

build() {
	CFLAGS="-fPIC $CFLAGS" make
}

check() {
	make test_client
	make test_store
}

package() {
	DESTDIR="$pkgdir" PREFIX=/usr make install
	rm -f "$pkgdir"/usr/lib/*.a
}

sha512sums="9fe494eb4a264a31c137a4f21e4a53358d55f6f6b3bd2fab0fbe43c0e85f2372127a2a85d00d2e308f3785b30cf8161de3f696aaf71c232f594ef3c54b8f6771  axc-0.3.3.tar.gz
0bfeb1f84734f2f513b97ebebc74c72fa7b08eadfb4ac0d9dac1b458ac09bd1f1937ac835af1f158a14064b19263f9ebfaa8ffb56ab7d6f52880de691e28fe10  0001-Add-make-install-target-shared-library-and-soname-su.patch
55c6f44318d48737b3a3ff75d52d46dedf2d06e133bc858496ec308515dad33e1f12a430d8fe9a61b98c028eb70bd9208478ba0cf83aa37d02366f9ed62aca8a  0002-added-pkgconfig-suport.patch
f727216e269103eb8d9c5300627abe88f0e59915d6267254b8d4b7f73ec7d604d700da78fc269c34d472e5750be27dcf9113c16056e51eaeadbc518816388d42  0003-no-longer-statically-build-against-libsignal-protoco.patch
a99f2ac2f67bfa446c222dc68ba6c95bc2372512ba02e520fab06d537076f2075a66e5ae62aa45a7faf5952188266f60c03d0645c17312025314de0963e9f09c  0004-Autogenerate-PKGCONFIG-file-through-Makefile.patch
83e5914034eed163e5b3dbf57661a8d91a1350b240d406af8fe69d8e321278b4ef358e1acf453f497dee21dcb3b591854e692cd0a92d30c74f61d7eef0caaaaf  0005-pkgconfig-file-generation-with-correct-Requires-fiel.patch"
