# Contributor: Michał Polański <michal@polanski.me>
# Maintainer: Michał Polański <michal@polanski.me>
pkgname=grype
pkgver=0.34.7
pkgrel=0
pkgdesc="Vulnerability scanner for container images, filesystems, and SBOMs"
url="https://github.com/anchore/grype"
license="Apache-2.0"
arch="all !armhf !armv7 !x86" # FTBFS on 32-bit arches
makedepends="go"
source="https://github.com/anchore/grype/archive/v$pkgver/grype-$pkgver.tar.gz"
options="!check" # tests need docker

export GOFLAGS="$GOFLAGS -trimpath -mod=readonly -modcacherw"
export GOPATH="$srcdir"
export CGO_ENABLED=0

build() {
	go build -o bin/grype
}

check() {
	go test ./...
}

package() {
	install -Dm755 bin/grype "$pkgdir"/usr/bin/grype
}

sha512sums="
671c40ceda25fcf7fae61492a4edd90f9e676ee86c2c7fb01180ac68a84dc0bfdd996fe2cb29f29f19897004d01de69fb337c3d2fb867655d1e0d019c8b159da  grype-0.34.7.tar.gz
"
