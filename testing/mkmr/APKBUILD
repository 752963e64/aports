# Contributor: Leo <thinkabit.ukim@gmail.com>
# Maintainer: Leo <thinkabit.ukim@gmail.com>
pkgname=mkmr
pkgver=0.0.12
pkgrel=1
pkgdesc="Make merge requests in any GitLab repo conveniently"
options="!check" # No testsuite
url="https://github.com/maxice8/mkmr"
arch="noarch"
license="GPL-3.0-or-later"
depends="
	python3
	py3-setuptools
	py3-gitlab
	py3-gitpython
	py3-python-editor
	py3-inquirer
	py3-giturlparse
	"
makedepends="scdoc"
subpackages="$pkgname-doc"
source="https://files.pythonhosted.org/packages/source/m/mkmr/mkmr-$pkgver.tar.gz
	https://github.com/maxice8/mkmr/commit/f60e3a431161e0de1eef91e17182b14f9c3a5f63.patch
	"

prepare() {
	default_prepare
	# Flit is dumb, use setuptools instead of distutilsc.core
	sed -i 's|distutils.core|setuptools|' setup.py
}

build() {
	python3 setup.py build

	for d in docs/*; do
		scdoc < $d > ${d%.scd}
	done
}

package() {
	python3 setup.py install --prefix=/usr --root="$pkgdir"
	mkdir -p "$pkgdir"/usr/share/man/man1
	mv docs/*.1 "$pkgdir"/usr/share/man/man1
}
sha512sums="62c1c5fda415541ebaa33f7497a38626914a7133cd9e707b1e5dda1d3500460a608036d7078e609940ca4a90e78193aba7281f2dda5b6e995f34de71a013211b  mkmr-0.0.12.tar.gz
640c5787cdc59baee1d20bb987687bd9063c2fb3e25af1b6dfa9e88ec0e56bb95de2c338aa0a419f792b564f10c1f719dbb7b0933ced5d02c94a0325ca3dcdb9  f60e3a431161e0de1eef91e17182b14f9c3a5f63.patch"
