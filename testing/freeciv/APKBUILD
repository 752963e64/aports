# Contributor: Thomas Kienlen <kommander@laposte.net>
# Maintainer: Thomas Kienlen <kommander@laposte.net>
pkgname=freeciv
pkgver=2.6.5
pkgrel=0
pkgdesc="Free and Open Source empire-building strategy game"
url="http://www.freeciv.org"
arch="all"
license="GPL-2.0-or-later"
depends="$pkgname-data $pkgname-server"
_common_makedepends="
	curl-dev
	readline-dev
	gettext
	sdl2_mixer-dev
	gzip
	"
_gtk3_client_makedepends="
	pkgconf
	glib-dev
	atk-dev
	pango-dev
	gdk-pixbuf-dev
	gtk+3.0-dev
	"
_server_makedepends="
	sqlite-dev
	"
makedepends="
	$_common_makedepends
	$_gtk3_client_makedepends
	$_server_makedepends
	"
source="https://downloads.sourceforge.net/sourceforge/freeciv/freeciv-$pkgver.tar.bz2"
subpackages="$pkgname-doc $pkgname-lang $pkgname-data::noarch $pkgname-server"

build() {
	./configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--enable-client=gtk3.22 \
		--enable-debug=no \
		--enable-fcmp=gtk3 \
		--enable-fcdb=sqlite3 \
		--enable-ipv6=yes \
		--with-readline \
		--build=$CBUILD --host=$CHOST

	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install
}

data() {
	pkgdesc="Freeciv files used by both client & server"
	depends=""
	mkdir -p "$subpkgdir/usr/share/freeciv"
	mv "$pkgdir/usr/share/freeciv" \
		"$subpkgdir/usr/share/"
}

server() {
	pkgdesc="Freeciv server"
	depends="$pkgname-data"

	mkdir -p "$subpkgdir/etc"
	mv "$pkgdir/etc/freeciv" \
		"$subpkgdir/etc/"

	_server_files="
		usr/bin/freeciv-server
		usr/share/applications/org.freeciv.server.desktop
		usr/share/appdata/freeciv-server.appdata.xml
		usr/share/icons/hicolor/128x128/apps/freeciv-server.png
		usr/share/icons/hicolor/16x16/apps/freeciv-server.png
		usr/share/icons/hicolor/32x32/apps/freeciv-server.png
		usr/share/icons/hicolor/48x48/apps/freeciv-server.png
		usr/share/icons/hicolor/64x64/apps/freeciv-server.png
		"

	for _server_file in $_server_files
	do
		_dest="$subpkgdir/$_server_file"
		mkdir -p "$(dirname $_dest)"
		mv "$pkgdir/$_server_file" \
			"$_dest"
	done
}

sha512sums="
a80d319d62395a65f089ba4e9f60af29e94209c06ab6e7dd0fb30009857e59f3b54f89f4aa0bd7671ca14bc4d17d468fc37f21bf447840292ab3cacb976ae17b  freeciv-2.6.5.tar.bz2
"
