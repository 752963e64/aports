# Contributor: Michał Polański <michal@polanski.me>
# Maintainer: Michał Polański <michal@polanski.me>
pkgname=weggli
pkgver=0_git20211002
_commit=f4b0ca262bf1b27776445effe79898ed6c231977
pkgrel=0
pkgdesc="Semantic search tool for C and C++ codebases"
url="https://github.com/googleprojectzero/weggli"
license="Apache-2.0"
arch="all !s390x !mips64 !riscv64" # blocked by rust/cargo
makedepends="cargo"
source="$pkgname-$pkgver.tar.gz::https://github.com/googleprojectzero/weggli/archive/$_commit.tar.gz"
builddir="$srcdir/weggli-$_commit"

build() {
	cargo build --release --locked
}

check() {
	cargo test --release --locked
}

package() {
	cargo install --locked --path . --root="$pkgdir"/usr
	rm "$pkgdir"/usr/.crates*
}

sha512sums="
f60e3860ff83bc4e2ee5f032b9d7efb3528ad846687132356d288191bd751b510a2cff4e64418346228f33404b0a11983285420bce9224f00c4e0005b2c64f5a  weggli-0_git20211002.tar.gz
"
