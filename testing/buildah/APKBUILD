# Contributor: kohnish <kohnish@gmx.com>
# Contributor: Michał Polański <michal@polanski.me>
# Maintainer: kohnish <kohnish@gmx.com>
pkgname=buildah
pkgver=1.19.3
pkgrel=1
pkgdesc="tool that facilitates building OCI container images"
url="https://github.com/containers/buildah"
arch="all !mips !mips64" # fails to build on mips
license="Apache-2.0"
depends="shadow-uidmap fuse-overlayfs slirp4netns"
makedepends="go go-md2man lvm2-dev gpgme-dev libseccomp-dev btrfs-progs-dev bash"
subpackages="$pkgname-doc"
options="!check" # TODO: enable tests
source="$pkgname-$pkgver.tar.gz::https://github.com/containers/buildah/archive/v$pkgver.tar.gz"

# secfixes:
#   1.14.4-r0:
#     - CVE-2020-10696

build() {
	GIT_COMMIT="$pkgver" make
}

package() {
	GIT_COMMIT="$pkgver" make install PREFIX=/usr DESTDIR="$pkgdir"
}

sha512sums="c168a255fdf0dea02c1fb255ecc948a649aae1ddffcfb09ace5d93e886572b69c91735f3ba8c6ccbdbe3ef34a4e2f7f32caedf98146bf91a63ec6da9d2ca4033  buildah-1.19.3.tar.gz"
