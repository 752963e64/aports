# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=wolfssl
pkgver=5.3.0
_pkgver=$pkgver-stable
pkgrel=0
pkgdesc="Embedded TLS Library"
url="https://www.wolfssl.com"
arch="all"
license="GPL-2.0-only"
makedepends="
	autoconf
	automake
	libtool
	"
subpackages="$pkgname-dbg $pkgname-dev"
source="https://github.com/wolfSSL/wolfssl/archive/v$_pkgver/wolfssl-$_pkgver.tar.gz"
builddir="$srcdir/$pkgname-$_pkgver"
options="!check"  # there are actually no tests! >_<

prepare() {
	default_prepare

	./autogen.sh
}

build() {
	# Note: Primary development uses automake, the support for CMake is
	# still under development.

	local extra_opts=
	case "$CARCH" in
		 x86_64) extra_opts="--enable-aesni";;
	esac

	# We use --enable-all and --enable-reproducible-build instead of
	# --enable-distro to ensure options.h gets installed.
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--disable-silent-rules \
		--enable-shared \
		--enable-static \
		--enable-reproducible-build \
		--enable-all \
		--enable-sha512 \
		--enable-bigcache \
		--enable-base64encode \
		--disable-md5 \
		--enable-sni \
		--enable-pkcs11 \
		--disable-examples \
		$extra_opts
	make
}

package() {
	make DESTDIR="$pkgdir" install

	# No useful stuff here.
	rm -rf "$pkgdir"/usr/share/doc
}

sha512sums="
399d2b8aad58471d237d21dea68c33fde2b9a3c117c554c241d9174db02847a6c31afae2908839d18f9ada317b2388560a24c077b76014f663227061342bf045  wolfssl-5.3.0-stable.tar.gz
"
