# Contributor: Peter Shkenev <santurysim@gmail.com>
# Maintainer: Peter Shkenev <santurysim@gmail.com>
pkgname=zmusic
pkgver=1.1.3
pkgrel=0
pkgdesc="GZDoom's music system as a standalone library"
url="https://github.com/coelckers/ZMusic"
arch="all !ppc64le" # ftbfs
license="GPL-3.0-or-later AND LGPL-3.0-or-later AND LGPL-2.1-or-later AND custom"
makedepends="cmake fluidsynth-dev libsndfile-dev mpg123-dev alsa-lib-dev samurai"
subpackages="$pkgname-dev $pkgname-doc"
options="!check"    # No test suite
source="https://github.com/coelckers/ZMusic/archive/refs/tags/$pkgver/zmusic-$pkgver.tar.gz"
builddir="$srcdir/ZMusic-$pkgver"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=MinSizeRel \
		$CMAKE_CROSSOPTS
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
	install -Dm644 licenses/dumb.txt "$pkgdir"/usr/share/licenses/$pkgname/dumb.txt
}



sha512sums="
df2ef962e7a6aebc35ce48eec4919d69e4d9603d410e161d5b5b36d0426098f4e7f540c6b036536f396c5d0311db5740ec9906bf882b507093cdf743df6f7512  zmusic-1.1.3.tar.gz
"
