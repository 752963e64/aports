# Contributor: Kevin Daudt <kdaudt@alpinelinux.org>
# Maintainer: Kevin Daudt <kdaudt@alpinelinux.org>
pkgname="chezmoi"
pkgver="1.7.3"
pkgrel=0
pkgdesc="Manage your dotfiles across multiple machines, securely."
url="https://www.chezmoi.io/"
arch="all"
license="MIT"
makedepends="go"
options="!check chmod-clean" # no test suite
subpackages="
	$pkgname-bash-completion:bashcomp:noarch
	$pkgname-zsh-completion:zshcomp:noarch
	$pkgname-fish-completion:fishcomp:noarch
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/twpayne/chezmoi/archive/v$pkgver.tar.gz"

export GOPATH="$srcdir"

build() {
	go build
	make completions
}

package() {
	install -Dm0755 chezmoi "$pkgdir"/usr/bin/chezmoi
}

bashcomp() {
	pkgdesc="additional scripts for bash like shell completion"
	depends=""
	install_if="$pkgname=$pkgver-r$pkgrel bash-completion"

	cd "$builddir"
	install -Dm0644 completions/chezmoi-completion.bash \
		"$subpkgdir"/usr/share/bash-completion/completions/$pkgname
}

zshcomp() {
	pkgdesc="additional scripts for zsh like shell completion"
	depends=""
	install_if="$pkgname=$pkgver-r$pkgrel zsh"

	cd "$builddir"
	install -Dm0644 completions/chezmoi.zsh \
		"$subpkgdir"/usr/share/zsh/site-functions/_$pkgname
}

fishcomp() {
	pkgdesc="additional scripts for fish like shell completion"
	depends=""
	install_if="$pkgname=$pkgver-r$pkgrel fish"

	cd "$builddir"
	install -Dm0644 completions/chezmoi.fish \
		"$subpkgdir"/usr/share/fish/site-functions/_$pkgname
}

cleanup_srcdir() {
	go clean -modcache
	default_cleanup_srcdir
}

sha512sums="36d274680c53dc3bdf8a3277f69d209ce5bf12e0a80811c38a3e65d58653b321904ae7c1b70eaae7764bb0abdaa013885d326403e44e983f9a9144af1c639c72  chezmoi-1.7.3.tar.gz"
