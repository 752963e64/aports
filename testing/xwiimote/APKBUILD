# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=xwiimote
pkgver=2
pkgrel=1
pkgdesc="Open-source Nintendo Wii Remote Linux Device Driver"
url="https://github.com/dvdhrm/xwiimote"
# ppc64le fails to build
arch="all !ppc64le"
license="MIT"
makedepends="
	autoconf
	automake
	doxygen
	eudev-dev
	libtool
	linux-headers
	ncurses-dev
	"
subpackages="$pkgname-static $pkgname-dev $pkgname-doc lib$pkgname:libs"
source="https://github.com/dvdhrm/xwiimote/archive/xwiimote-$pkgver/xwiimote-$pkgver.tar.gz
	0001-fix-32bit-build.patch
	xwiimote.conf
	"
builddir="$srcdir/$pkgname-$pkgname-$pkgver"

prepare() {
	default_prepare

	NOCONFIGURE=1 ./autogen.sh
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install
}

libs() {
	default_libs

	install -Dm644 -t "$subpkgdir"/usr/share/X11/xorg.conf.d "$builddir"/res/50-xorg-fix-xwiimote.conf
	install -Dm644 -t "$subpkgdir"/etc/modules-load.d "$srcdir"/xwiimote.conf
}

sha512sums="
b95aac35a13c15c05cf3069a0f30d28b0124263c41784a70816b8717b46fa8adcf0654b3d33f9806da047a94fee623bf4d9894a0bcb11332cefee3af91e8aab6  xwiimote-2.tar.gz
db35e34a0191c20d16c9a678bfd032f3282aee53d2d390cd04cf0d811176bca0de5643e35068493ef89d70c99e572c89f60d80af0dddfd940b5b94a3de74adeb  0001-fix-32bit-build.patch
ce1caa65cb231e9c2584bad8e7b8bb50ac3716ba6feb0d10a8fd271c401bc5a440c988b92f3321c5976a5ab5edf7ec8c5195d115f1c4c6ac9471f2a52a784e23  xwiimote.conf
"
