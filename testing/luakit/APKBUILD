# Contributor: SÃ¶ren Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer:
pkgname=luakit
pkgver=2.3
pkgrel=2
pkgdesc="Fast, small, webkit based browser framework extensible by Lua"
url="https://luakit.github.io/"
# armv7: fails to build
# s390x: install fails
# riscv64: no luajit
arch="all !armv7 !s390x !riscv64"
license="GPL-3.0-or-later"
depends="
	gsettings-desktop-schemas
	gst-plugins-good
	lua5.1-filesystem
	lua5.1-socket
	"
makedepends="webkit2gtk-dev luajit-dev"
checkdepends="xvfb luacheck lua5.1-luassert"
options="!check" #fixme
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/luakit/luakit/archive/$pkgver.tar.gz
	"

build() {
	make PREFIX=/usr USE_LUAJIT=1 DEVELOPMENT_PATHS=0
}

check() {
	make run-tests
}

package() {
	make PREFIX=/usr DESTDIR="$pkgdir" install
	mkdir -p "$pkgdir"/usr/share/doc/"$pkgname"
	mv "$pkgdir"/usr/share/"$pkgname"/doc/* "$pkgdir"/usr/share/doc/"$pkgname"
	rmdir "$pkgdir"/usr/share/"$pkgname"/doc
}

sha512sums="
98a473bcafbd082093689fd58b8c9828e3d79b8ae367ea4d030bb2b1671bf4f61a4f07fe57b99e6c69c40e26ad8b96b88b67e48ce085187923a1a1d976bdcee3  luakit-2.3.tar.gz
"
