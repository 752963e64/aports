# Contributor: Leon Marz <main@lmarz.org>
# Maintainer: Leon Marz <main@lmarz.org>
pkgname=opencl
# This is the version of the specification
pkgver=3.0.8
_headerver=2021.06.30
_cppver=2.0.15
_icdver=2021.06.30
pkgrel=0
pkgdesc="OpenCL ICD Loader"
url="https://khronos.org/opencl"
arch="all"
license="Apache-2.0"
makedepends="cmake"
subpackages="$pkgname-dev"
source="headers.tar.gz::https://github.com/KhronosGroup/OpenCL-Headers/archive/v$_headerver.tar.gz
	cpp.tar.gz::https://github.com/KhronosGroup/OpenCL-CLHPP/archive/v$_cppver.tar.gz
	icd.tar.gz::https://github.com/KhronosGroup/OpenCL-ICD-Loader/archive/v$_icdver.tar.gz
	"
options="!check" # tests are not functioning correctly

build() {
	cd "$srcdir/OpenCL-Headers-$_headerver"
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=None
	cmake --build build

	cd "$srcdir/OpenCL-CLHPP-$_cppver"
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DBUILD_DOCS=OFF \
		-DBUILD_EXAMPLES=OFF \
		-DBUILD_TESTS=OFF
	cmake --build build

	cd "$srcdir/OpenCL-ICD-Loader-$_icdver"
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_BUILD_TYPE=None \
		-DOPENCL_ICD_LOADER_HEADERS_DIR="$srcdir/OpenCL-Headers-$_headerver" \
		-DOPENCL_ICD_LOADER_BUILD_TESTING=OFF
	cmake --build build
}

package() {
	cd "$srcdir/OpenCL-Headers-$_headerver"
	DESTDIR="$pkgdir" cmake --install build

	cd "$srcdir/OpenCL-CLHPP-$_cppver"
	DESTDIR="$pkgdir" cmake --install build

	cd "$srcdir/OpenCL-ICD-Loader-$_icdver"
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
9d3ddf3a02ff4de00686f7e8cc7eef9f75e3c0e68920e787941c2d8a3ad895ae46d7c717894527a56144febf19ccc25ed733018d3d683509b1d8cc368d99b8ba  headers.tar.gz
d24c035425c8204099e5264e61939c568e85b64e94d5ed3c58fe9430f4516495a974080a684b742f5aea1351455a0755efccd14317c20cd34885880cf1d8133b  cpp.tar.gz
baee7fa33fe654034aae60cf9886d79a04f4dc61a1546bfa1016c66bfba103caa9fb7b55ee79854f2f7435afb40c82b1b6ff8022507279dea271ab4d96b0076e  icd.tar.gz
"
