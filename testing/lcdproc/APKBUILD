# Contributor: Thomas Liske <thomas@fiasko-nw.net>
# Maintainer: Thomas Liske <thomas@fiasko-nw.net>
pkgname=lcdproc
pkgver=0.5.6
pkgrel=0
pkgdesc="Multi-platform LCD display driver"
url="http://www.lcdproc.org/"
arch="all !armhf"
license="GPL-2.0-or-later"
makedepends="ncurses-dev libusb-compat-dev libftdi1-dev lirc-dev linux-headers libpng-dev freetype-dev"
subpackages="$pkgname-doc $pkgname-openrc"
source="https://downloads.sourceforge.net/lcdproc/lcdproc-$pkgver.tar.gz
	0001-time_h.patch
	0002-iface.patch
	0003-file_h.patch
	0004-menuscreens_h.patch
	0005-libftdi1.patch
	LCDd.initd
	lcdproc.initd
	"

prepare() {
	default_prepare
	update_config_sub
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc/lcdproc \
		--mandir=/usr/share/man \
		--localstatedir=/var/lib \
		--disable-static \
		--enable-stat-nfs \
		--enable-stat-smbfs \
		--enable-drivers="all,!irman,!svga" \
		--enable-libusb \
		--enable-libusb-1-0 \
		--enable-seamless-hbars \
		--enable-testmenus \
		--enable-permissive-menu-goto \
		--enable-lcdproc-menus

	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install

	# remove lcdproc client examples
	rm -f "$pkgdir"/usr/bin/*.pl

	install -Dm755 "$srcdir"/LCDd.initd "$pkgdir"/etc/init.d/LCDd
	install -Dm755 "$srcdir"/lcdproc.initd "$pkgdir"/etc/init.d/lcdproc
}

sha512sums="
7c506b4691c8544855dadf939863672230c3e0903bbe4bbde82df04ff932f818cdc406c5b159554ec155d0c46fff23d435121298f4e19bac73658b121c6b8220  lcdproc-0.5.6.tar.gz
0fcfbb4a9bfe2eefe683da1d2a761f9bd4b548b38e258bf98c7259d6b599d34fe30eed1d1440dc45167bf7c6f385a20e0a6fd6a2ae9ba067ba235f2c1e57fc8d  0001-time_h.patch
f11602a4670f78dcdcabfd56a4c113c6657739df8b6a39a20da01f6fe5d472e2050cc4373c10a8dfa31f62e6015f1f51cc17499344d695777ffcc932271e29df  0002-iface.patch
3d9c990f14ce525ec924adc4fc0ed6cf697cb919b92b40e9b01266bb5408d4cc7d697b672e9bcffd20b15ea865588911a5ed78c5ac2f3f5d4985f1518b8039eb  0003-file_h.patch
7e6118e0095faf288893d7d5dd6427d81861f6e0b3f974d29d329c1c1e0f613bb1b76f8a96081a9f62ef7ad3e72b8cf158e384104ecc18b0443729f8276bbac6  0004-menuscreens_h.patch
281ca07ed5eda53da8a1a5a15102366123756a7414914098431a06ce2a16e102b5c2e828c0d7381f67001a568dd6d195664452631135d2aa220b537c38e9d6cd  0005-libftdi1.patch
f635758025555096f961a526ca1dbc7290cda39efe92508eb1022082ffec5613416b828218f6d7d82b54621c910e1f389abb5da25b6fd0177eaf8b6694eda989  LCDd.initd
4ec5b701d8db0acad6b8509674fdca623aa1c8fcad0904f5553432f2f69868215882133de02ec286ba30e8027625e273a96ce6b85634f3731c527a08b53cf914  lcdproc.initd
"
