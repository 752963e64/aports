# Contributor: Peter Shkenev <santurysim@gmail.com>
# Maintainer: Peter Shkenev <santurysim@gmail.com>
pkgname=freediameter
pkgver=1.5.0
_gitcommit="33dbbd2"
pkgrel=0
pkgdesc="Free implementation of Diameter protocol"
url="https://github.com/open5gs/freediameter"
arch="all"
license="BSD-3-Clause"
makedepends="meson libgcrypt-dev libidn-dev gnutls-dev flex bison"
subpackages="$pkgname-dev $pkgname-libfdcore $pkgname-libfdproto"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/open5gs/freediameter/tarball/r$pkgver
	"
builddir="$srcdir/open5gs-freeDiameter-$_gitcommit"

build() {
	abuild-meson \
		. output
	meson compile ${JOBS:+-j ${JOBS}} -C output
}

check() {
	meson test --no-rebuild -v -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

libfdcore() {
	pkgdesc="$pkgdesc (core library)"
	amove usr/lib/libfdcore.so.1.5.0
	amove usr/lib/libfdcore.so.7
}

libfdproto() {
	pkgdesc="$pkgdesc (protocol library)"
	amove usr/lib/libfdproto.so.1.5.0
	amove usr/lib/libfdproto.so.7
}

sha512sums="
860c9fc7e00dac809936656ff9d5a04f28e15b37ff7e13d63a3dab9f6377c14a84939141d548f5b8f831bc505f915dbbb9bc1c35f885c70f8d0ac03f3aee7b48  freediameter-1.5.0.tar.gz
"
