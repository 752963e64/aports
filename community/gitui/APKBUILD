# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=gitui
# NOTE: If update-lockfile.patch is not applicable after bumping, apply only
# the previous patches, copy Cargo.lock to Cargo.lock.orig, run
# `cargo build --release`, interrupt it (^C) right after it starts building
# and generate a new diff (`diff -u Cargo.lock.orig Cargo.lock`).
pkgver=0.21.0
pkgrel=0
pkgdesc="Blazing fast terminal client for git"
url="https://github.com/extrawurst/gitui"
arch="x86_64 armv7 armhf aarch64 x86 ppc64le"  # limited by rust/cargo
license="MIT"
makedepends="cargo libgit2-dev oniguruma-dev openssl-dev>3 zlib-dev"
source="https://github.com/extrawurst/gitui/archive/v$pkgver/gitui-$pkgver.tar.gz
	use-system-openssl.patch
	use-oniguruma.patch
	update-lockfile.patch
	"

export LIBSSH2_SYS_USE_PKG_CONFIG=1  # use system libssh2
export RUSTONIG_DYNAMIC_LIBONIG=1  # use system libonig

_cargo_opts="--frozen --no-default-features"

prepare() {
	default_prepare
	cargo fetch --locked
}

build() {
	cargo build $_cargo_opts --release
}

check() {
	cargo test $_cargo_opts
}

package() {
	install -D -m755 target/release/gitui "$pkgdir"/usr/bin/gitui
}

sha512sums="
cbadbfc62a60a335242b9367da9b9a93f1721f9f10ff22ea3030cee7f1eabce95c0b2db7ba7faf4b995423e7c49b455605f12888a661265a4115b9710521d111  gitui-0.21.0.tar.gz
23f4d0f314caf512db8e5b7a26bcac04bcee5f2cd6b014675904e06b605adc70ad2cfbf83dee9a9217a9f8fc8b74e96c3b23a35d7a74b9c52eba4197c2a6d7f8  use-system-openssl.patch
4984c923498bf24adcbdc4966a3f6cb6f40b0dbeede7c6a3d5c1123128d6ef963a2afcec0e9ef2003d4afa2a006a1e50b6c3edb183d98b6d8bbd89d4cf40201a  use-oniguruma.patch
1a18bf449f96ebeec44a224b4c1b55516a5ada74103008dc755a643823c59e30cdaec970333b64aff651f2f10eb247a2577704fdb45a25443d713c5b4701909a  update-lockfile.patch
"
