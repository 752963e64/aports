# Contributor: Clayton Craft <clayton@craftyguy.net>
# Maintainer: Clayton Craft <clayton@craftyguy.net>
pkgname=unshield
pkgver=1.5.0
pkgrel=0
pkgdesc="Extracts CAB files from InstallShield installers"
# Note: only tested on the following archs, may work on others too but not
# adding them until this has been confirmed
arch="x86_64 aarch64 armv7"
url="https://github.com/twogood/unshield"
license="MIT"
makedepends="cmake zlib-dev"
checkdepends="bash"
source="$pkgname-$pkgver.tar.gz::https://github.com/twogood/unshield/archive/$pkgver.tar.gz"
subpackages="
	$pkgname-doc
	$pkgname-dev
	"
options="!check"
# Package includes unit tests but they fail to execute:
# https://github.com/twogood/unshield/issues/99

build() {
	cmake -B build . \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_BUILD_TYPE=None
	make -C build
}

check() {
	UNSHIELD=$builddir/src/unshield bash run-tests.sh
}

package() {
	make -C build DESTDIR="$pkgdir" install
}
sha512sums="
626d88293a6a71e7be4cd4ba85f5112edf7bf81a606439404d4da1b092fc1d30bcc3503921255438fba7bd541b806834fbc2446b7e586e46a89b182631a82353  unshield-1.5.0.tar.gz
"
