# Maintainer: psykose <alice@ayaya.dev>
pkgname=libtraceevent
pkgver=1.7.1
pkgrel=0
pkgdesc="Linux kernel trace event library"
url="https://git.kernel.org/pub/scm/libs/libtrace/libtraceevent.git"
arch="all"
license="LGPL-2.1-or-later AND GPL-2.0-or-later"
depends_dev="linux-headers"
makedepends="$depends_dev"
checkdepends="cunit-dev"
subpackages="$pkgname-plugins $pkgname-dev"
source="https://git.kernel.org/pub/scm/libs/libtrace/libtraceevent.git/snapshot/libtraceevent-$pkgver.tar.gz
	big-endian-typo.patch
	"

build() {
	make
}

check() {
	make test
}

package() {
	make \
		pkgconfig_dir=/usr/lib/pkgconfig \
		prefix=/usr \
		libdir_relative=lib \
		DESTDIR="$pkgdir" \
		install
	rm -v "$pkgdir"/usr/lib/*.a
}

plugins() {
	pkgdesc="$pkgdesc (plugins)"

	amove usr/lib/traceevent/plugins
}

sha512sums="
412b93109ccd6e1bdece52f9a10989a58ff5693144fd460c7ebaef0ebc4649fac95eea20c5f88aa2f23bdc59bf359a65ab23ab41c3a5b7c92df6e52225477093  libtraceevent-1.7.1.tar.gz
0b013e468cb7cfb0c5659158268c9c3988c69f729b49809b82136cbf54c7304d5684a43ededa5c97fa31e15503e1de953515811dfe205b3f1cdf7f35724e6c0d  big-endian-typo.patch
"
