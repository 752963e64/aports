# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=libresource
pkgver=0.25.0
pkgrel=0
_commit_dbusgmain="d42176ae4763e5288ef37ea314fe58387faf2005"
pkgdesc="Nemo's libresource"
url="https://github.com/sailfishos/libresource"
arch="all"
license="LGPL-2.1-only AND (AFL-2.1 OR GPL-2.0-or-later)"
depends_dev="
	check-dev
	dbus-dev
	dbus-glib-dev
	"
makedepends="$depends_dev
	autoconf
	automake
	libtool
	"
subpackages="$pkgname-static $pkgname-dev"
source="https://github.com/sailfishos/libresource/archive/$pkgver/libresource-$pkgver.tar.gz
	https://github.com/sailfishos-mirror/dbus-glib/archive/$_commit_dbusgmain/dbus-glib-$_commit_dbusgmain.tar.gz
	0001-add-missing-include.patch
	"
options="!check" # No suitable tests

prepare() {
	default_prepare

	rmdir dbus-gmain
	mv "$srcdir/dbus-glib-$_commit_dbusgmain" dbus-gmain
}

build() {
	./autogen.sh
	./configure \
		--prefix=/usr
	make -j1 # For some reason it breaks otherwise
}

package() {
	DESTDIR="$pkgdir" make install

	# Remove tests
	rm -rf "$pkgdir"/opt
}

sha512sums="
a23fc88ff03ac1accc64d4c1e38f888f404547a770672c543927e32174660c47db998e6c733792cab128a07a3aa731bd6b42c5b623ba71a4fcf2cc06e74c7632  libresource-0.25.0.tar.gz
665cd6395ee0ea14086ba30188c62a72697b3f63484681e18fc7f54109c9aca162f2e33aa2fa4d45287c6c0b590e81ca310c143dac0232cd5887692cdaf51256  dbus-glib-d42176ae4763e5288ef37ea314fe58387faf2005.tar.gz
bc422745d81552a68e8e3e4dd8be89c76bba10c123933efc37810448151e7ecdf20d9db12bbf05da59689513bead58ac66417eec7be0b235662a62ce8245f6ce  0001-add-missing-include.patch
"
