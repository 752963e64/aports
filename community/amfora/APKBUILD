# Contributor: omni <omni@gitlab.alpinelinux.org>
# Maintainer: omni <omni@gitlab.alpinelinux.org>
pkgname=amfora
pkgver=1.9.1 # Don't forget to update main.commit below
pkgrel=0
pkgdesc="terminal browser for the Gemini protocol"
url="https://github.com/makeworld-the-better-one/amfora"
license="GPL-3.0-or-later"
arch="all"
makedepends="go"
source="$pkgname-$pkgver.tar.gz::https://github.com/makeworld-the-better-one/amfora/archive/v$pkgver.tar.gz"

export GOPATH="$srcdir"
export GOFLAGS="$GOFLAGS -trimpath -mod=readonly -modcacherw"
case $CARCH in
	mips|mips64)
		export GOFLAGS="${GOFLAGS/-buildmode=pie}" # buildmode=pie is not supported on mips64
	;;
esac

build() {
	go build \
		-ldflags "-s -w -linkmode=external -extldflags \"$LDFLAGS\" \
			-X main.version=$pkgver -X main.builtBy=Alpine_Linux \
			-X main.commit=48d83d13d2029ad0158ed9a9388bcbb0813c9da4" \
		-v .
}

check() {
	go test -v ./...
}

package() {
	install -Dm0755 "$pkgname" -t "$pkgdir"/usr/bin
	install -Dm0644 "$pkgname".desktop -t "$pkgdir"/usr/share/applications
	install -Dm0644 default-config.toml -t "$pkgdir"/usr/share/"$pkgname"
}

sha512sums="5994acd6447b51af78678391affccd4e82fe1c91df63ae1f8e0352401aecf0b4e06e6ec44208369c376e8ed85eddea4898859b84535f00f1aa2ac9e66c925220  amfora-1.9.1.tar.gz"
