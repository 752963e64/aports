# Contributor: Rasmus Thomsen <oss@cogitri.dev>
# Contributor: Natanael Copa <ncopa@alpinelinux.org>
# Maintainer: Rasmus Thomsen <oss@cogitri.dev>
pkgname=librsvg
pkgver=2.52.7
pkgrel=0
pkgdesc="SAX-based renderer for SVG files into a GdkPixbuf"
url="https://wiki.gnome.org/Projects/LibRsvg"
arch="all !s390x !riscv64" # rust
license="LGPL-2.1-or-later"
subpackages="$pkgname-dbg $pkgname-dev $pkgname-doc"
makedepends="$depends_dev bzip2-dev cairo-dev glib-dev cargo rust vala
	gobject-introspection-dev gtk+3.0-dev libgsf-dev"
source="https://download.gnome.org/sources/librsvg/${pkgver%.*}/librsvg-$pkgver.tar.xz
	target.patch
	"
# tests are very dependent on versions of pango/cairo/freetype
options="!check"

# secfixes:
#   2.50.4-r0:
#     - RUSTSEC-2020-0146
#   2.46.2-r0:
#     - CVE-2019-20446

build() {
	export RUSTFLAGS="$RUSTFLAGS -C debuginfo=2"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--libexecdir=/usr/lib/$pkgname \
		--disable-static \
		--enable-vala
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
15c075d696ebba35555f93456be088e6398da5b7992119edc78f1ee1d376a70425248e36b138dc86234aec13cb139fded11d6d74523c44f9a49eb19c2151fcb7  librsvg-2.52.7.tar.xz
8cc9b9dd70a6dedb550a50e12a1bf0ca12f87487f432dcc2568d47412752565d563d7f488390108f49bda324b47387fec9386cf20be47e75d56fb482ecf0bb67  target.patch
"
