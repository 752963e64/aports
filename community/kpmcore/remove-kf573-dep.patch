From 7ec4b611dcf822439b081613cca4184689266454 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andrius=20=C5=A0tikonas?= <andrius@stikonas.eu>
Date: Fri, 16 Oct 2020 22:26:42 +0100
Subject: [PATCH] ecm_install_configured_files is only available in 5.73.

---
 CMakeLists.txt          |  1 -
 src/util/CMakeLists.txt | 50 +++++++++++++++++++++++++++++++++++++++++
 2 files changed, 50 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index bc97c19..189cd84 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -50,7 +50,6 @@ include(KDECompilerSettings NO_POLICY_SCOPE)
 include(FeatureSummary)
 include(GenerateExportHeader)
 include(ECMSetupVersion)
-include(ECMConfiguredInstall)
 
 ecm_setup_version(${VERSION} VARIABLE_PREFIX KPMCORE
                         VERSION_HEADER "${CMAKE_CURRENT_BINARY_DIR}/kpmcore_version.h"
diff --git a/src/util/CMakeLists.txt b/src/util/CMakeLists.txt
index 1daeacb..6e54258 100644
--- a/src/util/CMakeLists.txt
+++ b/src/util/CMakeLists.txt
@@ -58,6 +58,56 @@ install( FILES util/org.kde.kpmcore.helperinterface.conf DESTINATION ${KDE_INSTA
 install( FILES util/org.kde.kpmcore.applicationinterface.conf DESTINATION ${KDE_INSTALL_DBUSDIR}/system.d )
 
 kauth_install_actions(org.kde.kpmcore.externalcommand util/org.kde.kpmcore.externalcommand.actions)
+
+
+function(ecm_install_configured_files)
+    set(options COPYONLY ESCAPE_QUOTES @ONLY)
+    set(oneValueArgs DESTINATION COMPONENT)
+    set(multiValueArgs INPUT)
+
+    cmake_parse_arguments(ARGS "${options}" "${oneValueArgs}"
+                          "${multiValueArgs}" ${ARGN})
+
+
+    if(ARGS_UNPARSED_ARGUMENTS)
+        message(FATAL_ERROR "Unknown arguments given to ecm_install_configured_file(): \"${ARGS_UNPARSED_ARGUMENTS}\"")
+    endif()
+
+    if (NOT ARGS_DESTINATION)
+        message(FATAL_ERROR "missing DESTINATION argument to ECMConfiguredInstall")
+    endif()
+
+    foreach(_input ${ARGS_INPUT})
+        # convert absolute paths
+        get_filename_component(_name ${_input} NAME)
+
+        string(REGEX REPLACE "\\.in$"  "" _name ${_name})
+
+        set(_out_file ${CMAKE_CURRENT_BINARY_DIR}/${_name})
+
+        set(_configure_args)
+        if (ARGS_COPY_ONLY)
+                list(APPEND _configure_args COPY_ONLY)
+        endif()
+        if (ARGS_ESCAPE_QUOTES)
+                list(APPEND _configure_args  ESCAPE_QUOTES)
+        endif()
+        if (ARGS_@ONLY)
+                list(APPEND _configure_args @ONLY)
+        endif()
+
+        configure_file(${_input} ${_out_file} ${_configure_args})
+
+        if (DEFINED ARGS_COMPONENT)
+            set(_component COMPONENT ${ARGS_COMPONENT})
+        else()
+            set(_component)
+        endif()
+
+        install(FILES ${_out_file} DESTINATION ${ARGS_DESTINATION} ${_component})
+    endforeach()
+endfunction()
+
 ecm_install_configured_files(
     INPUT util/org.kde.kpmcore.helperinterface.service.in
     DESTINATION ${KDE_INSTALL_DBUSDIR}/system-services
-- 
GitLab

