# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=nymphcast
pkgver=0.1_alpha5
pkgrel=0
# mips64 blocked by poco -> nymphrpc
# armhf, s390x and riscv64 blocked by vlc
arch="all !mips64 !armhf !s390x !riscv64"
url="http://nyanko.ws/product_nymphcast.php"
pkgdesc="Audio and video casting system with support for custom applications"
license="BSD-3-Clause"
depends="avahi"
makedepends="
	alsa-lib-dev
	curl-dev
	ffmpeg-dev
	freeimage-dev
	freetype-dev
	libnymphcast-dev
	nymphrpc-dev
	openssl-dev
	qt5-qtbase-dev
	rapidjson-dev
	sdl2-dev
	sdl2_image-dev
	vlc-dev
	"
subpackages="$pkgname-openrc $pkgname-client"
source="https://github.com/MayaPosch/NymphCast/archive/v${pkgver/_/-}/nymphcast-v${pkgver/_/-}.tar.gz
	0001-player-install-location.patch
	"
options="!check" # No tests
builddir="$srcdir/NymphCast-${pkgver/_/-}"

build() {
	make -C src/server

	cd player/NymphCastPlayer
	qmake-qt5 PREFIX=/usr
	make
}

package() {
	make DESTDIR="$pkgdir" PREFIX=/usr -C src/server install
	make DESTDIR="$pkgdir" PREFIX=/usr -C src/server install-openrc
}

client() {
	cd "$builddir"/player/NymphCastPlayer
	make INSTALL_ROOT="$subpkgdir" install
}

sha512sums="
1bd8ac6c25b3790f95530977a44df560c9e3ec3c204c89d1cca7a5d274e2aff9dc577aa8118c722d04f136f0bfd437f02f008cc8010acb5c420cf6b99152f799  nymphcast-v0.1-alpha5.tar.gz
7125617fc15396bb32838bfa58bcd5e1aa72a326474ae3354bb5880459481138a95170494aeedf6f2292b5cc57bd520b41c5efb2e3320a6b6e7bfb12b80859ba  0001-player-install-location.patch
"
