# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
# Note: This project is basically dead, but it's still needed for some packages.
pkgname=ronn
_gemname=$pkgname-ng
pkgver=0.9.1
pkgrel=0
pkgdesc="Convert Markdown files to manpages"
url="https://github.com/apjanke/ronn-ng"
arch="noarch"
license="MIT"
depends="
	ruby
	ruby-kramdown
	ruby-mustache
	ruby-nokogiri
	"
checkdepends="
	ruby-rake
	ruby-test-unit
	"
subpackages="$pkgname-doc"
source="https://github.com/apjanke/$_gemname/archive/v$pkgver/$_gemname-$pkgver.tar.gz"
builddir="$srcdir/$_gemname-$pkgver"

build() {
	gem build $_gemname.gemspec
}

check() {
	rake test
}

package() {
	local gemdir="$pkgdir/$(ruby -e 'puts Gem.default_dir')"
	local geminstdir="$gemdir/gems/$_gemname-$pkgver"

	gem install --local \
		--install-dir "$gemdir" \
		--bindir "$pkgdir/usr/bin" \
		--ignore-dependencies \
		--no-document \
		--verbose \
		$_gemname

	install -D -m 644 "$geminstdir"/man/$pkgname.1 \
		"$pkgdir"/usr/share/man/man1/$pkgname.1
	install -D -m 644 "$geminstdir"/man/$pkgname-format.7 \
		"$pkgdir"/usr/share/man/man7/$pkgname-format.7

	# Remove unnecessary files and rubbish...
	cd "$gemdir"
	rm -r cache build_info doc extensions plugins
	cd "$geminstdir"
	rm -r test man Rakefile [A-Z][A-Z][A-Z]*
}

sha512sums="
03d6856598740ff670a500b182d0be84b584c98245e81b605de6c126b79680be48d2ed18d4cf28252c0a82883b4740ae58c584e977d3f0a9480082a9eb560a9a  ronn-ng-0.9.1.tar.gz
"
