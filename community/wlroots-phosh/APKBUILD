# Contributor: Henrik Riomar <henrik.riomar@gmail.com>
# Contributor: Drew DeVault <sir@cmpwn.com>
# Maintainer: Newbyte <newbie13xd@gmail.com>
pkgname=wlroots-phosh
_pkgname=wlroots
pkgver=0.14.1
pkgrel=0
pkgdesc="Modular Wayland compositor library patched to work with Phosh"
url="https://gitlab.freedesktop.org/wlroots/wlroots"
license="MIT"
arch="all"
makedepends="
	eudev-dev
	libcap-dev
	libinput-dev
	libseat-dev
	libxcb-dev
	libxkbcommon-dev
	mesa-dev
	meson
	ninja
	pixman-dev
	wayland-dev
	wayland-protocols
	xcb-util-image-dev
	xcb-util-renderutil-dev
	xcb-util-wm-dev
	xkeyboard-config
	xwayland-dev
	"
subpackages="$pkgname-dbg $pkgname-dev"
source="https://gitlab.freedesktop.org/wlroots/wlroots/-/archive/$pkgver/wlroots-$pkgver.tar.gz
	0001-Revert-layer-shell-error-on-0-dimension-without-anch.patch
	de1522aeee04e23522398fe5cee17af67de7602a.patch
	e479dc1ef0fe5165cd2456927cdf153ce206e023.patch
	"
options="!check" # no test suite
builddir="$srcdir/$_pkgname-$pkgver"
replaces="wlroots0.12"

build() {
	abuild-meson \
		-Dexamples=false \
		. build
	meson compile ${JOBS:+-j ${JOBS}} -C build
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C build
}

sha512sums="
4f557c827f9673eccf208a3644954de80e7355b95cc374cc5e851a47087b227f196e0936c0913d21a6c776c29b74de2d028a100931264e41934c747568d8ebe0  wlroots-0.14.1.tar.gz
5547741b35fc8364360dabb93a6f988b6be9299b77ee4adf2c7edfcd4a3c97f2f0cbbd19a41548254fe5d2327ed45300824920ce3c9d0cb0846a3ba5b5a83e02  0001-Revert-layer-shell-error-on-0-dimension-without-anch.patch
08e507ea74fda95d46cf77e39742e1c38ef10a8fe5452f6d465bffeb8e7c9cc5da2062b38013efa3c41622e020d14e1c389c0c788a46b5c24ff7e48d9537b576  de1522aeee04e23522398fe5cee17af67de7602a.patch
d58d5cf241b992fc6b6c96b2b0ffed31bb440c700e0bdb94c5e351fd4e7e34759021391a823831393c74812a39bf98afa0730ed503dda6acd5bc6fe8fac0fdb8  e479dc1ef0fe5165cd2456927cdf153ce206e023.patch
"
