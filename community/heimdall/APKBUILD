# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Henrik Grimler <henrik@grimler.se>
pkgname=heimdall
pkgver=2.0.2
pkgrel=0
pkgdesc="Free implementation of Samsung Galaxy devices flashing protocol"
url="https://git.sr.ht/~grimler/Heimdall"
arch="all"
license="MIT"
makedepends="libusb-dev cmake"
source="$pkgname-v$pkgver.tar.gz::https://git.sr.ht/~grimler/Heimdall/archive/v$pkgver.tar.gz
	heimdall_flash_kernel.sh
	heimdall_flash_isorec_kernel.sh
	heimdall_wait_for_device.sh
	"
options="!check" # No tests
builddir="$srcdir/Heimdall-v$pkgver"

build() {
	cmake -B build \
		-DCMAKE_BUILD_TYPE=None \
		-DDISABLE_FRONTEND=ON
	cmake --build build
}

package() {
	cd build
	for i in bin/heimdall "$srcdir"/heimdall_flash_kernel.sh "$srcdir"/heimdall_flash_isorec_kernel.sh "$srcdir"/heimdall_wait_for_device.sh; do
		install -Dm755 "$i" "$pkgdir"/usr/bin/"${i##*/}"
	done
}

sha512sums="
62849bfe7550214dd774efea65169673fa916f9d204000f793d995aed9def95fcc895c8913cd648f2397ab7fd154257e0394b78c180ed60d043c75858bac7c0a  heimdall-v2.0.2.tar.gz
271098ddcead6b4d1edd76ac208099506d67a7640b40c68ea4d8a6a85b6fa464b6024371004b02f1a3c4bdfc38415cf63f2fde97099e52db72903227d653b9b8  heimdall_flash_kernel.sh
ed6892ca86906473fcf84a4919396762e7a5639fdaf6360052764e1d522f52d6a1fd6137c9ebc3f5e096c489b8e8d38688740e96799a5426d87ed48bc68a9253  heimdall_flash_isorec_kernel.sh
45e742bb3a8c8d0bc6806a4e9f860b04f255cad72a8602c04759178284c66e0a90d3ea22249b5fa69de1dd1d6ecd6221adaa63d611aa20d2a54aa20868e86a9f  heimdall_wait_for_device.sh
"
