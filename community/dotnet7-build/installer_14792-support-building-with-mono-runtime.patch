From 7662587f10552d4aad04ba2b95e5643ae2107d6f Mon Sep 17 00:00:00 2001
From: Tom Deseyn <tom.deseyn@gmail.com>
Date: Wed, 19 Oct 2022 15:21:40 +0200
Subject: [PATCH 1/1] Enabled source-building with mono runtime on any
 architecture.

Adds an argument to the top-level build script to use the mono
runtime, and sets the flags needed for the different repos
to work with mono.
---
 eng/SourceBuild.props                         |   1 +
 .../tarball/content/Directory.Build.props     |   5 +
 src/SourceBuild/tarball/content/build.sh      |   4 +
 .../content/repos/Directory.Build.props       |   1 +
 ...d-support-building-with-mono-runtime.patch |  24 ++
 ...d-support-building-with-mono-runtime.patch |  24 ++
 ...d-support-building-with-mono-runtime.patch | 324 ++++++++++++++++++
 7 files changed, 383 insertions(+)
 create mode 100644 src/SourceBuild/tarball/patches/aspnetcore/0002-source-build-support-building-with-mono-runtime.patch
 create mode 100644 src/SourceBuild/tarball/patches/runtime/0001-source-build-support-building-with-mono-runtime.patch
 create mode 100644 src/SourceBuild/tarball/patches/sdk/0001-source-build-support-building-with-mono-runtime.patch

diff --git a/src/installer/eng/SourceBuild.props b/src/installer/eng/SourceBuild.props
index a2831d574..9ebca97ff 100644
--- a/src/installer/eng/SourceBuild.props
+++ b/src/installer/eng/SourceBuild.props
@@ -11,6 +11,7 @@
       <InnerBuildArgs>$(InnerBuildArgs) /p:IncludeNuGetPackageArchive=false</InnerBuildArgs>
       <InnerBuildArgs>$(InnerBuildArgs) /p:IncludeAdditionalSharedFrameworks=false</InnerBuildArgs>
       <InnerBuildArgs>$(InnerBuildArgs) /p:IncludeSharedFrameworksForBackwardsCompatibilityTests=false</InnerBuildArgs>
+      <InnerBuildArgs Condition="'$(SourceBuildUseMonoRuntime)' == 'true'">$(InnerBuildArgs) /p:DISABLE_CROSSGEN=true</InnerBuildArgs>
     </PropertyGroup>
   </Target>
 
-- 
2.36.3

