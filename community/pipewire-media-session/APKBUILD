# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=pipewire-media-session
pkgver=0.4.0
pkgrel=1
pkgdesc="Low-latency audio/video router and processor - Session manager"
url="https://pipewire.org/"
# s390x blocked by pipewire
arch="all !s390x"
license="LGPL-2.1-or-later"
makedepends="
	alsa-lib-dev
	dbus-dev
	doxygen
	meson
	pipewire-dev>=0.3.39
	"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://gitlab.freedesktop.org/PipeWire/media-session/-/archive/$pkgver/media-session-$pkgver.tar.gz"
options="!check" # No tests
builddir="$srcdir/media-session-$pkgver"

provides="pipewire-session-manager"
replaces="pipewire-media-session<0.3.39 pipewire-pulse<0.3.39 pipewire-jack<0.3.39 pipewire-alsa<0.3.39 pipewire-spa-bluez<0.3.39"

build() {
	abuild-meson \
		-Ddocs=enabled \
		. output
	meson compile ${JOBS:+-j ${JOBS}} -C output
}

check() {
	meson test --no-rebuild -v -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}
sha512sums="
b37c85b85c47e7871066e511947673c7016f72baa00e940907db63e1e7554dfb200d7608ab6ec8ccd4cf84b6d7113894dad956e379bba69d1d8d882dc5b899f2  pipewire-media-session-0.4.0.tar.gz
"
