# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=image-roll
pkgver=2.0.1
pkgrel=0
pkgdesc="Simple and fast GTK image viewer with basic image manipulation tools"
url="https://github.com/weclaw1/image-roll"
arch="x86_64 armv7 armhf aarch64 x86 ppc64le"  # limited by rust/cargo
license="MIT"
makedepends="cargo gtk4.0-dev"
source="https://github.com/weclaw1/image-roll/archive/$pkgver/image-roll-$pkgver.tar.gz"
options="!check"  # no tests provided

export CARGO_PROFILE_RELEASE_CODEGEN_UNITS=1
export CARGO_PROFILE_RELEASE_LTO="true"
export CARGO_PROFILE_RELEASE_OPT_LEVEL="s"
export CARGO_PROFILE_RELEASE_PANIC="abort"

prepare() {
	default_prepare

	# This build script just installs glib schema to ~/.
	rm build.rs

	cargo fetch --locked
}

build() {
	cargo build --frozen --release --no-default-features  # w/o wallpaper
}

package() {
	local appid='com.github.weclaw1.ImageRoll'

	install -D -m755 target/release/image-roll -t "$pkgdir"/usr/bin/

	install -D -m644 src/resources/$appid.desktop -t "$pkgdir"/usr/share/applications/
	install -D -m644 src/resources/$appid.metainfo.xml -t "$pkgdir"/usr/share/metainfo/
	install -D -m644 src/resources/$appid.gschema.xml -t "$pkgdir"/usr/share/glib-2.0/schemas/

	install -D -m644 -t "$pkgdir"/usr/share/icons/hicolor/scalable/apps/ \
		src/resources/$appid.svg \
		src/resources/$appid.Devel.svg \
		src/resources/$appid-symbolic.svg
}

sha512sums="
0f8d4d5a20da018c2d83e1521e87a9664d177f1e4590642a3048fbf616d1c3ce79aaa714487a9745e9ef4eb965f6848b567137a20a8068980487106f2c05a164  image-roll-2.0.1.tar.gz
"
