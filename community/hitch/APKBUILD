# Contributor: Raphael Cohn <raphael.cohn@stormmq.com>
# Contributor: prez <prez@national.shitposting.agency>
# Maintainer: Raphael Cohn <raphael.cohn@stormmq.com>
pkgname=hitch
pkgver=1.6.1
pkgrel=1
pkgdesc="hitch is a TLS / SSL endpoint like stunnel"
url="https://hitch-tls.org/"
arch="all"
license="BSD-2-Clause"
makedepends="libev-dev openssl-dev py3-docutils bison flex"
install="$pkgname.pre-install"
subpackages="$pkgname-doc $pkgname-openrc"
source="https://hitch-tls.org/source/hitch-$pkgver.tar.gz
	hitch.initd
	hitch.confd
	hitch.conf
	"

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--enable-tcp-fastopen
	make
}

package() {
	make DESTDIR="$pkgdir" install

	install -Dm755 "$srcdir/$pkgname.initd" "$pkgdir/etc/init.d/$pkgname"
	install -Dm644 "$srcdir/$pkgname.confd" "$pkgdir/etc/conf.d/$pkgname"
	install -Dm644 "$srcdir/$pkgname.conf" "$pkgdir/etc/$pkgname/hitch.conf"

	mkdir -p "$pkgdir"/usr/share/doc/$pkgname/examples/
	install -m644 hitch.conf.example \
		"$pkgdir"/usr/share/doc/$pkgname/examples/
}

sha512sums="8e4a78d600775fa9e35c1b40fb1a469c6fbc2b44f41df29f754c7c188f109c551525aae2e804b503618046be25aeda6ceb66130a151ca5691e148b6775b2826c  hitch-1.6.1.tar.gz
40e0863bea1d302de1e60f1e9c87a2d5896f0a168d054eaaba90ee136168e61ffa1e5f0bb08a5d42d737441377abba3965fec2dd3015ea6155cd2bb8ec21dc22  hitch.initd
ec2c3e009fc8f144d3b2fb6ad01ead608949b2b0d299db0be8fb4953cce867d55107b20054d2d98888c8e4aef423d0d99325bd28c512b4c3800d5dd1ba759f13  hitch.confd
c2db10a0fec44958f9e3056b013743b4f6c4d0aa21e030120bf7e2f9a3941e276ca1f85ab2a1c051ac17aacd857cae13f308f4d192edc61b2322ab9dbe99f99c  hitch.conf"
