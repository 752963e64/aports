# Contributor: Leo <thinkabit.ukim@gmail.com>
# Maintainer: Michał Polański <michal@polanski.me>
pkgname=seatd
pkgver=0.6.1
pkgrel=0
pkgdesc="Minimal seat management daemon"
url="https://sr.ht/~kennylevinsen/seatd/"
license="MIT"
arch="all !ppc64le !mips64" # build failure
options="suid"
pkggroups="seat"
install="$pkgname.pre-install"
makedepends="meson scdoc elogind-dev linux-headers"
subpackages="libseat:libs libseat-dev $pkgname-doc $pkgname-openrc"
source="$pkgname-$pkgver.tar.gz::https://git.sr.ht/~kennylevinsen/seatd/archive/$pkgver.tar.gz
	seatd.initd
	"

build() {
	abuild-meson \
		-Dlibseat-logind=elogind \
		-Dman-pages=enabled \
		. output

	meson compile ${JOBS:+-j ${JOBS}} -C output
}

check() {
	meson test --no-rebuild -v -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
	chmod u+s "$pkgdir"/usr/bin/seatd-launch

	install -Dm755 "$srcdir"/seatd.initd "$pkgdir"/etc/init.d/seatd
}

libs() {
	default_libs
	pkgdesc="Universal seat management library"
}

dev() {
	default_dev
	pkgdesc="Universal seat management library (development files)"
}

sha512sums="
b4a6fb28e2b2d06bb7a50e0e8e187bfc0fda559195219434e2665af9246432d0f21492d38277d6e27efcf1e4d90939450e83ddb893021c9abcf05abef4ba6c9c  seatd-0.6.1.tar.gz
e37a46121d1edbe76be3eeff25651ac84a55c2dc6b2211005fe39bf4051df0fc427315b0b4a660b66193fb16b641a7203fc5e201c391f9bb3b4f02c26a5d39cc  seatd.initd
"
