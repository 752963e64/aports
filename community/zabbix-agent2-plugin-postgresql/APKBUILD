# Maintainer: Leonardo Arena <rnalrd@alpinelinux.org>
pkgname=zabbix-agent2-plugin-postgresql
pkgver=6.2.7
pkgrel=0
pkgdesc="Zabbix Agent 2 PostgreSQL loadable plugin"
url="https://git.zabbix.com/projects/AP/repos/postgresql/browse"
arch="all"
license="Apache-2.0"
makedepends="go gettext-dev"
subpackages=""
source="https://cdn.zabbix.com/zabbix-agent2-plugins/sources/postgresql/$pkgname-$pkgver.tar.gz
	0001-set-plugin-system-path.patch
	"

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
	export CGO_LDFLAGS="$LDFLAGS -s -w"
	make
}

package() {
	install -D -m644 postgresql.conf \
		"$pkgdir"/etc/zabbix/zabbix_agent2.d/plugins.d/postgresql.conf
	install -D -m755 zabbix-agent2-plugin-postgresql \
		"$pkgdir"/usr/libexec/zabbix-agent2/postgresql
}

check() {
	make check
}

sha512sums="
d1235a4c7174dcba36e7df867f4a4c51ad6c43c8386cc7e66906158135e401557186090aa215d31c29d2cba5110e4d6a908afa53c56e0936b2f84e7a84f4f990  zabbix-agent2-plugin-postgresql-6.2.7.tar.gz
a63a2a20e78c8349b1a8d08470d89b5feb73cf2483bec9069a2b159151e46d69f510541a9a624153ffb2a002fff0684e3fd2559f256f4073790e88304e991f59  0001-set-plugin-system-path.patch
"
