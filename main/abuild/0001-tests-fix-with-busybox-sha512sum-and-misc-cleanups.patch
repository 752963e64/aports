From 57ec5043f079fcf312442d26ce8421ef0b122890 Mon Sep 17 00:00:00 2001
From: Natanael Copa <ncopa@alpinelinux.org>
Date: Fri, 30 Apr 2021 13:57:20 +0200
Subject: [PATCH] tests: fix with busybox sha512sum and misc cleanups

---
 tests/abuild.bats | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/tests/abuild.bats b/tests/abuild.bats
index 79e146a..e46cee4 100644
--- a/tests/abuild.bats
+++ b/tests/abuild.bats
@@ -88,7 +88,7 @@ teardown() {
 
 @test "abuild: test checksum generation" {
 	mkdir -p "$tmpdir"/foo
-	cat >> "$tmpdir"/foo/APKBUILD <<-EOF
+	cat > "$tmpdir"/foo/APKBUILD <<-EOF
 		pkgname="foo"
 		pkgver="1.0"
 		source="test.txt"
@@ -96,14 +96,14 @@ teardown() {
 	echo "foo" > "$tmpdir"/foo/test.txt
 	cd "$tmpdir"/foo
 	$ABUILD checksum
-	. ./APKBUILD && echo "$sha512sums" > sums
+	. ./APKBUILD && echo "$sha512sums" | sed '/^$/d' > sums
 	cat sums
 	sha512sum -c sums
 }
 
 @test "abuild: test duplicates in checksum generation" {
 	mkdir -p "$tmpdir"/foo "$tmpdir"/foo/dir1 "$tmpdir"/foo/dir2
-	cat >> "$tmpdir"/foo/APKBUILD <<-EOF
+	cat > "$tmpdir"/foo/APKBUILD <<-EOF
 		pkgname="foo"
 		pkgver="1.0"
 		source="dir1/testfile dir2/testfile"
@@ -117,7 +117,7 @@ teardown() {
 
 @test "abuild: test that -dbg should be first" {
 	mkdir -p "$tmpdir"/foo
-	cat >> "$tmpdir"/foo/APKBUILD <<-EOF
+	cat > "$tmpdir"/foo/APKBUILD <<-EOF
 		# Maintainer: Test user <user@example.com>
 		pkgname="foo"
 		pkgver="1.0"
-- 
2.31.1

