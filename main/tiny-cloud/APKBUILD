# Contributor: Mike Crute <mike@crute.us>
# Contributor: Jake Buchholz Göktürk <tomalok@gmail.com>
# Maintainer: Jake Buchholz Göktürk <tomalok@gmail.com>
pkgname=tiny-cloud
pkgver=2.0.0_rc3
pkgrel=0
pkgdesc="Tiny Cloud instance bootstrapper"
url="https://gitlab.alpinelinux.org/alpine/cloud/tiny-cloud"
arch="noarch"
license="MIT"
options="!check"  # no tests provided
depends="e2fsprogs-extra partx sfdisk"
source="$url/-/archive/$pkgver/$pkgname-$pkgver.tar.gz"
subpackages="
	$pkgname-network
	$pkgname-openrc
	$pkgname-aws
	$pkgname-azure
	$pkgname-gcp
	$pkgname-oci
"

package() {
	make PREFIX="$pkgdir" core openrc
}

network() {
	pkgdesc="Tiny Cloud - networking module"
	depends="ifupdown-ng iproute2-minimal $pkgname=$pkgver-r$pkgrel"
	cd "$builddir"
	make PREFIX="$subpkgdir" network
}

aws() {
	pkgdesc="Tiny Cloud - Amazon Web Services module"
	depends="nvme-cli $pkgname-network=$pkgver-r$pkgrel"
	provides="tiny-ec2-bootstrap"
	cd "$builddir"
	make PREFIX="$subpkgdir" aws
}

azure() {
	pkgdesc="Tiny Cloud - Azure module"
	depends="$pkgname=$pkgver-r$pkgrel"
	cd "$builddir"
	make PREFIX="$subpkgdir" azure
}

gcp() {
	pkgdesc="Tiny Cloud - Google Cloud Platform module"
	depends="$pkgname=$pkgver-r$pkgrel"
	cd "$builddir"
	make PREFIX="$subpkgdir" gcp
}

oci() {
	pkgdesc="Tiny Cloud - Oracle Cloud Infrastructure module"
	depends="$pkgname=$pkgver-r$pkgrel"
	cd "$builddir"
	make PREFIX="$subpkgdir" oci
}

sha512sums="
ca36c7f0b659e2a21b484d913c6fe1f5ac1458f40e988967125978ce6e2ff3de44441352c7461be448cefd19b0cea23b1c8d948af22a9d6c7f21589c3ba7735a  tiny-cloud-2.0.0_rc3.tar.gz
"
