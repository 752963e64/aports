# Contributor: Michael Zhou <zhoumichaely@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=jbig2dec
pkgver=0.17
_gsver="gs950"
pkgrel=1
pkgdesc="JBIG2 image compression format decoder"
url="https://jbig2dec.com/"
arch="all"
license="GPL-2.0-or-later"
makedepends="autoconf automake libtool"
checkdepends="python2"
subpackages="$pkgname-dev $pkgname-doc"
source="https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/$_gsver/jbig2dec-$pkgver.tar.gz
	CVE-2020-12268.patch
	"

builddir="$srcdir/$pkgname-$pkgver"

prepare() {
	default_prepare
	cd "$builddir"
	autoreconf -vif
}

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--localstatedir=/var \
		--without-libpng
	make
}

check() {
	cd "$builddir"
	make check
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}

sha512sums="e1ac4af318fb31e097b558e6b88334d35e035d1378b152aabb025f2918969a3a79c6a6644848fccf5d4eaa6efaf2b0422ff01d5bbcde8245f7af6fa29022d9b8  jbig2dec-0.17.tar.gz
1ecace9d053348de57f0c5c26c6e81aa8515d9578efe1c90b28e23091f4afc3b02e9df084b0af67f78e4b0f8920df659e98af20c9194199367780a79a87342a0  CVE-2020-12268.patch"
