# Contributor: Łukasz Jendrysik <scadu@yandex.com>
# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Contributor: Takuya Noguchi <takninnovationresearch@gmail.com>
# Maintainer: Fabian Affolter <fabian@affolter-engineering.ch>
pkgname=ansible
pkgver=2.4.6.0
pkgrel=1
pkgdesc="A configuration-management, deployment, task-execution, and multinode orchestration framework"
url="https://ansible.com"
arch="noarch"
license="GPL3+"
_py=py2
depends="python2 $_py-yaml $_py-paramiko $_py-jinja2 $_py-markupsafe $_py-crypto"
makedepends="python2-dev py-setuptools"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://releases.ansible.com/ansible/$pkgname-$pkgver.tar.gz
	CVE-2019-10206.patch
	"
builddir="$srcdir/$pkgname-$pkgver"

# secfixes:
#   2.4.6.0-r1:
#   - CVE-2019-10206
#   2.4.6.0-r0:
#   - CVE-2018-10855

build() {
	cd "$builddir"
	python2 setup.py build
}

package() {
	cd "$builddir"
	python2 setup.py install --prefix=/usr --root="$pkgdir"

	mkdir -p "$pkgdir"/usr/share/man/man1
	install -Dm644 "$builddir"/docs/man/man1/*.1 \
		"$pkgdir"/usr/share/man/man1/

	mkdir -p "$pkgdir"/usr/share/doc/$pkgname/examples/
	install -m644 examples/* \
		"$pkgdir"/usr/share/doc/$pkgname/examples/
	install -m644 README.md "$pkgdir"/usr/share/doc/$pkgname
}

sha512sums="3b4d4d8f3b1eb27861e7beac4557b608e3f9a77d4a24d33868c8d1be2b3fd9a57ef98e4685bbfd859d64a2f591487852fb5409ef00006036be4409eaf07d1b5b  ansible-2.4.6.0.tar.gz
cdc065686625c1724e1f286f2a4986920195c8714fea640c90b663499aa9e8709c52e11590b7816dcd753c68c5c5787d964056bdd8252bc06ff6ca1731a38bc2  CVE-2019-10206.patch"
