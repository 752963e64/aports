From bbf6bd8a50a02d5015a2b0043abfbf2b4e6acce6 Mon Sep 17 00:00:00 2001
From: Leo <thinkabit.ukim@gmail.com>
Date: Fri, 11 Dec 2020 02:07:01 -0300
Subject: [PATCH 1/2] CVE-2020-24583

---
 django/core/files/storage.py | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/django/core/files/storage.py b/django/core/files/storage.py
index 98c89dd..9643198 100644
--- a/django/core/files/storage.py
+++ b/django/core/files/storage.py
@@ -310,9 +310,9 @@ class FileSystemStorage(Storage):
         if not os.path.exists(directory):
             try:
                 if self.directory_permissions_mode is not None:
-                    # os.makedirs applies the global umask, so we reset it,
-                    # for consistency with file_permissions_mode behavior.
-                    old_umask = os.umask(0)
+                    # Set the umask because os.makedirs() doesn't apply the "mode"
+                    # argument to intermediate-level directories.
+                    old_umask = os.umask(0o777 & ~self.directory_permissions_mode)
                     try:
                         os.makedirs(directory, self.directory_permissions_mode)
                     finally:
-- 
2.29.2

