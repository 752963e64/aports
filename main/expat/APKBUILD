# Maintainer: Carlo Landmeter <clandmeter@gmail.com>
pkgname=expat
pkgver=2.2.10
pkgrel=0
pkgdesc="An XML Parser library written in C"
url="http://www.libexpat.org/"
arch="all"
license='MIT'
checkdepends="bash"
source="https://github.com/libexpat/libexpat/releases/download/R_${pkgver//./_}/expat-$pkgver.tar.xz
	CVE-2021-45960.patch
	CVE-2021-46143.patch
	CVE-2022-22822.patch
	"
subpackages="$pkgname-static $pkgname-dev $pkgname-doc"

# secfixes:
#   2.2.10-r0:
#     - CVE-2021-45960
#     - CVE-2021-46143
#     - CVE-2022-22822
#     - CVE-2022-22823
#     - CVE-2022-22824
#     - CVE-2022-22825
#     - CVE-2022-22826
#     - CVE-2022-22827
#   2.2.7-r1:
#     - CVE-2019-15903
#   2.2.7-r0:
#     - CVE-2018-20843
#   2.2.0-r1:
#     - CVE-2017-9233

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--mandir=/usr/share/man \
		--enable-static
	make
}

check() {
	cd "$builddir"
	make check
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir/" install
}

sha512sums="
a8e0c8a9cf7e6fbacdc6e709f3c99c533ab550fba52557d24259bb8b360f9697624c7500c0e9886fa57ee2b529aadd0d1835d66fe8112e15c20df75cd3eb090f  expat-2.2.10.tar.xz
4afd3777fc682a2f9057d4cc42afe6e04680d7d24f93dc11a2677cb8b1a4b400921f6d689e2953aff4a3312118ea801c9e161f85774360b3b5c2d3bd0067f7ad  CVE-2021-45960.patch
dd0339a0cdf5b18638a5732f2f9930af7adb5b20aa3bf102317a571f0f7d4f453313f0d8fdaa60f89c7a8f2e59eeaaca4b9c2e427a45594b7e21ed7c253d547a  CVE-2021-46143.patch
dcf6bfc07b4919b1248dba5fc6d4e425d09975b09255d77456bb44b40495e92b4d4ffae6a9e949b204770848b70edfc4be1869c191cb01ebe967b1906ffc9d59  CVE-2022-22822.patch
"
