From c601e12f7fb1947987c6da04f22fb9a87a2c11b1 Mon Sep 17 00:00:00 2001
From: Natanael Copa <ncopa@alpinelinux.org>
Date: Tue, 9 Nov 2021 11:14:21 +0100
Subject: [PATCH] Load simpledrm kernel module early

This is needed for early console
---
 features.d/base.modules | 1 +
 initramfs-init.in       | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/features.d/base.modules b/features.d/base.modules
index ec440f1..4100645 100644
--- a/features.d/base.modules
+++ b/features.d/base.modules
@@ -1,2 +1,3 @@
 kernel/drivers/block/loop.ko*
+kernel/drivers/gpu/drm/tiny/simpledrm.ko*
 kernel/fs/overlayfs
diff --git a/initramfs-init.in b/initramfs-init.in
index bbe2f82..c560f37 100755
--- a/initramfs-init.in
+++ b/initramfs-init.in
@@ -457,7 +457,7 @@ fi
 # load available drivers to get access to modloop media
 ebegin "Loading boot drivers"
 
-modprobe -a $(echo "$KOPT_modules $rootfstype" | tr ',' ' ' ) loop squashfs 2> /dev/null
+modprobe -a $(echo "$KOPT_modules $rootfstype" | tr ',' ' ' ) loop squashfs simpledrm 2> /dev/null
 if [ -f /etc/modules ] ; then
 	sed 's/\#.*//g' < /etc/modules |
 	while read module args; do
-- 
2.33.1

